

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Stock Prices &#8212; Financial Data Science Python Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'stock_prices';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Jegadeesh-Titman Rolling Portfolios" href="jegadeesh_titman.html" />
    <link rel="prev" title="FINANCIAL DATA SCIENCE" href="README.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
  
    <p class="title logo__title">Financial Data Science Python Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    FINANCIAL DATA SCIENCE
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Stock Prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="jegadeesh_titman.html">Jegadeesh-Titman Rolling Portfolios</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_french.html">Fama-French Portfolio Sorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_macbeth.html">Fama-Macbeth Cross-sectional Regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="weekly_reversal.html">Contrarian Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="quant_factors.html">Quant Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_study.html">Event Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="economic_releases.html">Economic Data Revisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_diagnostics.html">Linear Regression Diagonostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econometric_forecast.html">Econometric Forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="approximate_factors.html">Approximate Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="economic_states.html">State Space Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="term_structure.html">Term Structure of Interest Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="bond_returns.html">Bond Returns and Risks</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_volatility.html">Conditional Volatility and VaR</a></li>
<li class="toctree-l1"><a class="reference internal" href="covariance_matrix.html">Covariance Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="options_pricing.html">Options Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="market_microstructure.html">Market Microstructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_risk.html">Event Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer_ego.html">Principal Customers Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="industry_community.html">Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="bea_centrality.html">Graph Centrality</a></li>
<li class="toctree-l1"><a class="reference internal" href="link_prediction.html">Link Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial_regression.html">Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_topics.html">FOMC Topic Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="management_sentiment.html">Management Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="business_description.html">Business Text Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification_models.html">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_models.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_classifier.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="recurrent_net.html">Recurrent Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="convolutional_net.html">Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="reinforcement_learning.html">Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_language.html">FedSpeak Language Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_llm.html">LLM Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="summarization_llm.html">LLM Text Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="finetune_llm.html">LLM Finetuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag_agent.html">RAG, Chatbots and Agents</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git/issues/new?title=Issue%20on%20page%20%2Fstock_prices.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/stock_prices.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Stock Prices</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#universe-selection">Universe selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-stock-returns">Measuring Stock Returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-yahoo-finance-prices">Retrieve Yahoo Finance prices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-splits-and-dividends">Stock Splits and Dividends</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-delistings">Stock Delistings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sql">SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-stock-returns">Properties of stock returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#long-run-market-averages">Long-run Market Averages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moments-of-individual-stock-returns">Moments of individual stock returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlations">Correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Stock Delistings</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="stock-prices">
<h1>Stock Prices<a class="headerlink" href="#stock-prices" title="Permalink to this heading">#</a></h1>
<p><em>In physics it takes three laws to explain 99% of the data; in finance it takes more than 99 laws to explain about 3%</em> - Andrew Lo</p>
<p>Concepts:</p>
<ul class="simple">
<li><p>Fama-French universe and size deciles</p></li>
<li><p>Stock splits, dividends and delistings</p></li>
<li><p>Properties of stock returns</p></li>
</ul>
<p><strong>References:</strong></p>
<ul class="simple">
<li><p>Bali, Turan G, Robert F Engle, and Scott Murray. 2016. Empirical asset pricing: The cross section of stock returns. John Wiley &amp; Sons.</p></li>
<li><p>Fama, Eugene F., and Kenneth R. French. 1992. “The cross-section of expected stock returns.” The Journal of Finance 47 (2): 427–65.</p></li>
<li><p>Shumway, Tyler. 1997. The Delisting Bias in CRSP Data. The Journal of Finance, 52, 327-340.</p></li>
<li><p>Stulz, René M., 2018, “The Shrinking Universe of Public Firms: Facts, Causes, and Consequences”, National Bureau of Economics, 2 (June 2018)</p></li>
<li><p>FRM Exam Book Part I Quantative Analysis Chapter 12</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">finds.database</span> <span class="kn">import</span> <span class="n">SQL</span><span class="p">,</span> <span class="n">RedisDB</span>
<span class="kn">from</span> <span class="nn">finds.structured</span> <span class="kn">import</span> <span class="n">BusDay</span><span class="p">,</span> <span class="n">CRSP</span><span class="p">,</span> <span class="n">CRSPBuffer</span><span class="p">,</span> <span class="n">Benchmarks</span>
<span class="kn">from</span> <span class="nn">finds.utils</span> <span class="kn">import</span> <span class="n">Finder</span><span class="p">,</span> <span class="n">plot_date</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">CRSP_DATE</span><span class="p">,</span> <span class="n">paths</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># %matplotlib qt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open database connections</span>
<span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">rdb</span> <span class="o">=</span> <span class="n">RedisDB</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;redis&#39;</span><span class="p">])</span>
<span class="n">bd</span> <span class="o">=</span> <span class="n">BusDay</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">endweek</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">crsp</span> <span class="o">=</span> <span class="n">CRSP</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">rdb</span><span class="o">=</span><span class="n">rdb</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">bench</span> <span class="o">=</span> <span class="n">Benchmarks</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">find</span> <span class="o">=</span> <span class="n">Finder</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">outdir</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;scratch&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="universe-selection">
<h2>Universe selection<a class="headerlink" href="#universe-selection" title="Permalink to this heading">#</a></h2>
<p>The Center for Research in Security Prices (CRSP) provides the most widely used data for academic research into US stocks. Following Fama and French (1992), the CRSP universe is trimmed to only
include US-domiciled, exchange-listed stocks:</p>
<ul class="simple">
<li><p>shrcd in [10, 11]</p></li>
<li><p>exchcd in [1, 2, 3]</p></li>
</ul>
<p>The universe is typically divided into 10 market capitalization-based deciles (with the 10th decile comprising the smallest stocks) whose breakpoints are determined only from those
stocks listed on the NYSE.  For a company with multiple classes securities, the combined market value of the company is used for all classes of its securities.  The plots below of the market cap
breakpoints of and the number of stocks in each decile by year are consistent with the observations by Stulz (2018) and others of the shrinking universe of public US firms and increased concentration of mega-cap stocks in recent years.</p>
<p>The shrout (shares outstanding) field in CRSP is in units of  thousands of shares. Hence all calculations and derivations (such as market capitalization) need to be multipled by 1000 to get the true value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve universe of stocks annually from 1981</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="mi">19731231</span><span class="p">)</span>
<span class="n">rebals</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">CRSP_DATE</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">univs</span> <span class="o">=</span> <span class="p">{</span><span class="n">rebal</span><span class="p">:</span> <span class="n">crsp</span><span class="o">.</span><span class="n">get_universe</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">rebal</span><span class="p">)</span> <span class="k">for</span> <span class="n">rebal</span> <span class="ow">in</span> <span class="n">rebals</span><span class="p">}</span>
<span class="n">num</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">univ</span> <span class="ow">in</span> <span class="n">univs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">num</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">date</span><span class="o">//</span><span class="mi">10000</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="n">decile</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">univ</span><span class="p">[</span><span class="s1">&#39;decile&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">decile</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">decile</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)}</span>
<span class="n">num</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot number of stocks in each size decile</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Number of stocks in universe by size decile&#39;</span><span class="p">)</span>
<span class="n">num</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="c1">#set_xtickbins(ax=ax, nbins=len(cap)//10)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Size Decile&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/24ee20f363ed315e0ce7a74d9ddabd709b569c5c6995ac8b344d7a3985916c48.png" src="_images/24ee20f363ed315e0ce7a74d9ddabd709b569c5c6995ac8b344d7a3985916c48.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For assigning into size deciles, sum up the company&#39;s total market</span>
<span class="c1"># capitalization instead of separate capital values each security if multiple classes</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="s1">&#39;ALPHABET&#39;</span><span class="p">,</span> <span class="s1">&#39;comnam&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span>
<span class="n">find</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="s1">&#39;permco&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;permco&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>comnam</th>
      <th>ncusip</th>
      <th>shrcls</th>
      <th>ticker</th>
      <th>permno</th>
      <th>nameendt</th>
      <th>shrcd</th>
      <th>exchcd</th>
      <th>siccd</th>
      <th>tsymbol</th>
      <th>naics</th>
      <th>primexch</th>
      <th>trdstat</th>
      <th>secstat</th>
      <th>permco</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20040819</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOG</td>
      <td>90319</td>
      <td>20050818</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>514191</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20050819</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOG</td>
      <td>90319</td>
      <td>20060720</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>518111</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20060721</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOG</td>
      <td>90319</td>
      <td>20080131</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>518112</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>3</th>
      <td>20080201</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOG</td>
      <td>90319</td>
      <td>20140402</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>519130</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>4</th>
      <td>20140403</td>
      <td>GOOGLE INC</td>
      <td>38259P70</td>
      <td>C</td>
      <td>GOOG</td>
      <td>14542</td>
      <td>20150423</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>519130</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20140403</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOGL</td>
      <td>90319</td>
      <td>20150423</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOGL</td>
      <td>519130</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>6</th>
      <td>20150424</td>
      <td>GOOGLE INC</td>
      <td>38259P70</td>
      <td>C</td>
      <td>GOOG</td>
      <td>14542</td>
      <td>20151004</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>519190</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>7</th>
      <td>20150424</td>
      <td>GOOGLE INC</td>
      <td>38259P50</td>
      <td>A</td>
      <td>GOOGL</td>
      <td>90319</td>
      <td>20151004</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOGL</td>
      <td>519190</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>8</th>
      <td>20151005</td>
      <td>ALPHABET INC</td>
      <td>02079K10</td>
      <td>C</td>
      <td>GOOG</td>
      <td>14542</td>
      <td>20180201</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>519190</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>9</th>
      <td>20151005</td>
      <td>ALPHABET INC</td>
      <td>02079K30</td>
      <td>A</td>
      <td>GOOGL</td>
      <td>90319</td>
      <td>20180201</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOGL</td>
      <td>519190</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>10</th>
      <td>20180202</td>
      <td>ALPHABET INC</td>
      <td>02079K10</td>
      <td>C</td>
      <td>GOOG</td>
      <td>14542</td>
      <td>20231012</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>334419</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>11</th>
      <td>20180202</td>
      <td>ALPHABET INC</td>
      <td>02079K30</td>
      <td>A</td>
      <td>GOOGL</td>
      <td>90319</td>
      <td>20231012</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOGL</td>
      <td>334419</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>12</th>
      <td>20231013</td>
      <td>ALPHABET INC</td>
      <td>02079K10</td>
      <td>C</td>
      <td>GOOG</td>
      <td>14542</td>
      <td>20231229</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOG</td>
      <td>541511</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
    <tr>
      <th>13</th>
      <td>20231013</td>
      <td>ALPHABET INC</td>
      <td>02079K30</td>
      <td>A</td>
      <td>GOOGL</td>
      <td>90319</td>
      <td>20231229</td>
      <td>11</td>
      <td>3</td>
      <td>7375</td>
      <td>GOOGL</td>
      <td>541511</td>
      <td>Q</td>
      <td>A</td>
      <td>R</td>
      <td>45483</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">univ</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>  <span class="c1"># market caps of share class and total company</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cap</th>
      <th>capco</th>
      <th>decile</th>
      <th>nyse</th>
      <th>siccd</th>
      <th>prc</th>
      <th>naics</th>
    </tr>
    <tr>
      <th>permno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14542</th>
      <td>806824250.0</td>
      <td>1.633510e+09</td>
      <td>1</td>
      <td>False</td>
      <td>7375</td>
      <td>140.93</td>
      <td>541511</td>
    </tr>
    <tr>
      <th>90319</th>
      <td>826685420.0</td>
      <td>1.633510e+09</td>
      <td>1</td>
      <td>False</td>
      <td>7375</td>
      <td>139.69</td>
      <td>541511</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="measuring-stock-returns">
<h2>Measuring Stock Returns<a class="headerlink" href="#measuring-stock-returns" title="Permalink to this heading">#</a></h2>
<p>In addition to gains from appreciated stock prices, adjusted for stock splits (<code class="docutils literal notranslate"><span class="pre">facpr</span></code> in CRSP), investors’ total holding returns also include ordinary cash dividends (<code class="docutils literal notranslate"><span class="pre">divamt</span></code> in CRSP).</p>
<p>The total holding return on an asset from <span class="math notranslate nohighlight">\(t-1\)</span> to <span class="math notranslate nohighlight">\(t\)</span> includes both price appreciation and any dividends paid on record date <span class="math notranslate nohighlight">\(t\)</span>: <span class="math notranslate nohighlight">\(R_t = \dfrac{P_t + D_t - P_{t-1}}{P_{t-1}}\)</span>. Ex-dividend means a company’s dividend allocations have been specified. The ex-dividend date or “ex-date” is usually one business day before the record date.</p>
<p>The return of an asset over multiple periods is calculated using the product of the simple returns in each period: <span class="math notranslate nohighlight">\(1 + R_T = \Pi_{t=1}^{T} (1 + R_t)\)</span>.  This implicitly assumes that dividends have been reinvested in the same asset.</p>
<p>There are also continuously compounded returns, or log returns. These are computed as the difference of the natural logarithm of the price: $r_t = ln Pt - ln Pt - 1</p>
<section id="retrieve-yahoo-finance-prices">
<h3>Retrieve Yahoo Finance prices<a class="headerlink" href="#retrieve-yahoo-finance-prices" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The historical “close” from Yahoo Finance is the split-adjusted price</p></li>
<li><p>The historical “adjclose” from Yahoo Finance is equal to the dividend- and split-adjusted price:
Daily changes of “adjclose” reflects the total holdings returns which includes the effect of both stock splits and cash dividends received.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prices from Yahoo Finance</span>
<span class="kn">from</span> <span class="nn">yahoo</span> <span class="kn">import</span> <span class="n">get_price</span>
<span class="n">ticker</span> <span class="o">=</span> <span class="s1">&#39;AAPL&#39;</span>
<span class="n">date</span> <span class="o">=</span> <span class="mi">20200101</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>
<span class="n">prices_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open</th>
      <th>high</th>
      <th>low</th>
      <th>close</th>
      <th>adjClose</th>
      <th>volume</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20200103</th>
      <td>74.29</td>
      <td>75.14</td>
      <td>74.12</td>
      <td>74.36</td>
      <td>72.35</td>
      <td>146322800.0</td>
    </tr>
    <tr>
      <th>20200106</th>
      <td>73.45</td>
      <td>74.99</td>
      <td>73.19</td>
      <td>74.95</td>
      <td>72.93</td>
      <td>118387200.0</td>
    </tr>
    <tr>
      <th>20200107</th>
      <td>74.96</td>
      <td>75.22</td>
      <td>74.37</td>
      <td>74.60</td>
      <td>72.58</td>
      <td>108872000.0</td>
    </tr>
    <tr>
      <th>20200108</th>
      <td>74.29</td>
      <td>76.11</td>
      <td>74.29</td>
      <td>75.80</td>
      <td>73.75</td>
      <td>132079200.0</td>
    </tr>
    <tr>
      <th>20200109</th>
      <td>76.81</td>
      <td>77.61</td>
      <td>76.55</td>
      <td>77.41</td>
      <td>75.32</td>
      <td>170108400.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20240417</th>
      <td>169.61</td>
      <td>170.65</td>
      <td>168.00</td>
      <td>168.00</td>
      <td>168.00</td>
      <td>50901200.0</td>
    </tr>
    <tr>
      <th>20240418</th>
      <td>168.03</td>
      <td>168.64</td>
      <td>166.55</td>
      <td>167.04</td>
      <td>167.04</td>
      <td>43122900.0</td>
    </tr>
    <tr>
      <th>20240419</th>
      <td>166.21</td>
      <td>166.40</td>
      <td>164.08</td>
      <td>165.00</td>
      <td>165.00</td>
      <td>67772100.0</td>
    </tr>
    <tr>
      <th>20240422</th>
      <td>165.52</td>
      <td>167.26</td>
      <td>164.77</td>
      <td>165.84</td>
      <td>165.84</td>
      <td>48116400.0</td>
    </tr>
    <tr>
      <th>20240423</th>
      <td>165.35</td>
      <td>167.05</td>
      <td>164.92</td>
      <td>166.90</td>
      <td>166.90</td>
      <td>48917700.0</td>
    </tr>
  </tbody>
</table>
<p>1083 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">get_price</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_date</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;adjClose&#39;</span><span class="p">]],</span> <span class="n">legend1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="s1">&#39;adjClose&#39;</span><span class="p">],</span>
          <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2"> prices from Yahoo Finance&quot;</span><span class="p">,</span>
          <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: title={&#39;center&#39;: &#39;AAPL prices from Yahoo Finance&#39;}&gt;
</pre></div>
</div>
<img alt="_images/0aeb03a229d75ea974d0488f47c4167ec36df2952ee9676cbce0c429e31adfd8.png" src="_images/0aeb03a229d75ea974d0488f47c4167ec36df2952ee9676cbce0c429e31adfd8.png" />
</div>
</div>
<p><strong>Estimate dividend amount</strong></p>
<p>Differences between daily changes in adjClose and close are estimates of dividend amounts (scaled by prior adjClose) on ex-dates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lookup AAPL&#39;s permno identifier</span>
<span class="n">find</span> <span class="o">=</span> <span class="n">Finder</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">permno</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;permno&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># dividend yield is excess of change in adjClose over chance in close</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;divyld&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;adjClose&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;adjClose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">()))</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c1"># ex-dates inferred to be when amount is larger than rounding error</span>
<span class="n">exdt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;divyld&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">.0001</span><span class="p">]</span>
<span class="n">yahoo_div</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">exdt</span><span class="p">,</span> <span class="s1">&#39;divyld&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="stock-splits-and-dividends">
<h3>Stock Splits and Dividends<a class="headerlink" href="#stock-splits-and-dividends" title="Permalink to this heading">#</a></h3>
<p>Retrieve CRSP distributions</p>
<p><strong>Dividend amount per share</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crsp_div</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="o">**</span><span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT divamt, exdt, retx, prc FROM dist INNER JOIN daily</span>
<span class="s2">ON dist.permno = daily.permno AND dist.exdt = daily.date AND dist.exdt &lt;= </span><span class="si">{</span><span class="n">CRSP_DATE</span><span class="si">}</span><span class="s2"></span>
<span class="s2">WHERE dist.permno=</span><span class="si">{</span><span class="n">permno</span><span class="si">}</span><span class="s2"> AND dist.exdt&gt;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> AND dist.divamt &gt; 0</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
<span class="n">crsp_div</span> <span class="o">=</span> <span class="n">crsp_div</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;exdt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">crsp_div</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>divamt</th>
      <th>retx</th>
      <th>prc</th>
    </tr>
    <tr>
      <th>exdt</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20200207</th>
      <td>0.770</td>
      <td>-0.015928</td>
      <td>320.03</td>
    </tr>
    <tr>
      <th>20200508</th>
      <td>0.820</td>
      <td>0.021038</td>
      <td>310.13</td>
    </tr>
    <tr>
      <th>20200807</th>
      <td>0.820</td>
      <td>-0.024495</td>
      <td>444.45</td>
    </tr>
    <tr>
      <th>20201106</th>
      <td>0.205</td>
      <td>-0.002856</td>
      <td>118.69</td>
    </tr>
    <tr>
      <th>20210205</th>
      <td>0.205</td>
      <td>-0.004586</td>
      <td>136.76</td>
    </tr>
    <tr>
      <th>20210507</th>
      <td>0.220</td>
      <td>0.003623</td>
      <td>130.21</td>
    </tr>
    <tr>
      <th>20210806</th>
      <td>0.220</td>
      <td>-0.006256</td>
      <td>146.14</td>
    </tr>
    <tr>
      <th>20211105</th>
      <td>0.220</td>
      <td>0.002120</td>
      <td>151.28</td>
    </tr>
    <tr>
      <th>20220204</th>
      <td>0.220</td>
      <td>-0.002950</td>
      <td>172.39</td>
    </tr>
    <tr>
      <th>20220506</th>
      <td>0.230</td>
      <td>0.003253</td>
      <td>157.28</td>
    </tr>
    <tr>
      <th>20220805</th>
      <td>0.230</td>
      <td>-0.002774</td>
      <td>165.35</td>
    </tr>
    <tr>
      <th>20221104</th>
      <td>0.230</td>
      <td>-0.003600</td>
      <td>138.38</td>
    </tr>
    <tr>
      <th>20230210</th>
      <td>0.230</td>
      <td>0.000928</td>
      <td>151.01</td>
    </tr>
    <tr>
      <th>20230512</th>
      <td>0.240</td>
      <td>-0.006791</td>
      <td>172.57</td>
    </tr>
    <tr>
      <th>20230811</th>
      <td>0.240</td>
      <td>-0.001011</td>
      <td>177.79</td>
    </tr>
    <tr>
      <th>20231110</th>
      <td>0.240</td>
      <td>0.021874</td>
      <td>186.40</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare CRSP actual and Yahoo Finance estimated dividend amounts</span>
<span class="n">div</span> <span class="o">=</span> <span class="n">crsp_div</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">yahoo_div</span><span class="p">)</span>
<span class="n">div</span><span class="p">[</span><span class="s1">&#39;yahoo_div&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">div</span><span class="p">[</span><span class="s1">&#39;divyld&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">div</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">div</span><span class="p">[</span><span class="s1">&#39;retx&#39;</span><span class="p">]))</span>
<span class="n">div</span><span class="p">[[</span><span class="s1">&#39;divamt&#39;</span><span class="p">,</span> <span class="s1">&#39;yahoo_div&#39;</span><span class="p">,</span> <span class="s1">&#39;prc&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>divamt</th>
      <th>yahoo_div</th>
      <th>prc</th>
    </tr>
    <tr>
      <th>exdt</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20200207</th>
      <td>0.770</td>
      <td>0.772</td>
      <td>320.03</td>
    </tr>
    <tr>
      <th>20200508</th>
      <td>0.820</td>
      <td>0.822</td>
      <td>310.13</td>
    </tr>
    <tr>
      <th>20200807</th>
      <td>0.820</td>
      <td>0.822</td>
      <td>444.45</td>
    </tr>
    <tr>
      <th>20201106</th>
      <td>0.205</td>
      <td>0.205</td>
      <td>118.69</td>
    </tr>
    <tr>
      <th>20210205</th>
      <td>0.205</td>
      <td>0.205</td>
      <td>136.76</td>
    </tr>
    <tr>
      <th>20210507</th>
      <td>0.220</td>
      <td>0.220</td>
      <td>130.21</td>
    </tr>
    <tr>
      <th>20210806</th>
      <td>0.220</td>
      <td>0.220</td>
      <td>146.14</td>
    </tr>
    <tr>
      <th>20211105</th>
      <td>0.220</td>
      <td>0.220</td>
      <td>151.28</td>
    </tr>
    <tr>
      <th>20220204</th>
      <td>0.220</td>
      <td>0.220</td>
      <td>172.39</td>
    </tr>
    <tr>
      <th>20220506</th>
      <td>0.230</td>
      <td>0.230</td>
      <td>157.28</td>
    </tr>
    <tr>
      <th>20220805</th>
      <td>0.230</td>
      <td>0.230</td>
      <td>165.35</td>
    </tr>
    <tr>
      <th>20221104</th>
      <td>0.230</td>
      <td>0.230</td>
      <td>138.38</td>
    </tr>
    <tr>
      <th>20230210</th>
      <td>0.230</td>
      <td>0.230</td>
      <td>151.01</td>
    </tr>
    <tr>
      <th>20230512</th>
      <td>0.240</td>
      <td>0.240</td>
      <td>172.57</td>
    </tr>
    <tr>
      <th>20230811</th>
      <td>0.240</td>
      <td>0.240</td>
      <td>177.79</td>
    </tr>
    <tr>
      <th>20231110</th>
      <td>0.240</td>
      <td>0.240</td>
      <td>186.40</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Split adjustment factors</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crsp_fac</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="o">**</span><span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT 1 + facpr as facpr, exdt FROM dist </span>
<span class="s2">WHERE permno=</span><span class="si">{</span><span class="n">permno</span><span class="si">}</span><span class="s2"> AND exdt&gt;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> AND facpr &gt; 0.0</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;exdt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Retrieve CRSP raw prices around ex-dates</span>
<span class="n">crsp_prc</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="o">**</span><span class="n">sql</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT date, prc from daily</span>
<span class="s2">WHERE permno=</span><span class="si">{</span><span class="n">permno</span><span class="si">}</span><span class="s2"> AND date&gt;</span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">crsp_fac</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">  AND date&lt;</span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">crsp_fac</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Factor to Adjust Price, <code class="docutils literal notranslate"><span class="pre">facpr</span></code>, can be used to adjust prices for
distributions (usually stock dividends and splits) so that stock prices
before and after the distribution are comparable.</p>
<p>The historical cumulative adjust factors are computed by additing 1 to and then taking cumulative product from current to earlier time periods. This cumulative factor between two dates is divided into the earlier raw stock price to derive comparable split-adjusted prices. Hence to split-adjust CRSP raw prices</p>
<ul class="simple">
<li><p>apply cumulative factor to raw prices before corresponding ex-date</p></li>
<li><p>back-fill to dates prior to ex-date</p></li>
<li><p>default factor after latest ex-date is 1</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare split-adjusted CRSP price to Yahoo Finance close price</span>
<span class="n">crsp_fac</span> <span class="o">=</span> <span class="n">crsp_fac</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">crsp_prc</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>\
                   <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>\
                   <span class="o">.</span><span class="n">bfill</span><span class="p">()</span>\
                   <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>\
                   <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crsp_prc</span><span class="p">)</span>
<span class="n">crsp_fac</span><span class="p">[</span><span class="s1">&#39;prc_adjusted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crsp_fac</span><span class="p">[</span><span class="s1">&#39;prc&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">crsp_fac</span><span class="p">[</span><span class="s1">&#39;facpr&#39;</span><span class="p">]</span>
<span class="n">crsp_fac</span><span class="p">[[</span><span class="s1">&#39;prc&#39;</span><span class="p">,</span> <span class="s1">&#39;prc_adjusted&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;close&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>prc</th>
      <th>prc_adjusted</th>
      <th>close</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20200825</th>
      <td>499.30</td>
      <td>124.825</td>
      <td>124.825</td>
    </tr>
    <tr>
      <th>20200826</th>
      <td>506.09</td>
      <td>126.522</td>
      <td>126.522</td>
    </tr>
    <tr>
      <th>20200827</th>
      <td>500.04</td>
      <td>125.010</td>
      <td>125.010</td>
    </tr>
    <tr>
      <th>20200828</th>
      <td>499.23</td>
      <td>124.808</td>
      <td>124.808</td>
    </tr>
    <tr>
      <th>20200831</th>
      <td>129.04</td>
      <td>129.040</td>
      <td>129.040</td>
    </tr>
    <tr>
      <th>20200901</th>
      <td>134.18</td>
      <td>134.180</td>
      <td>134.180</td>
    </tr>
    <tr>
      <th>20200902</th>
      <td>131.40</td>
      <td>131.400</td>
      <td>131.400</td>
    </tr>
    <tr>
      <th>20200903</th>
      <td>120.88</td>
      <td>120.880</td>
      <td>120.880</td>
    </tr>
    <tr>
      <th>20200904</th>
      <td>120.96</td>
      <td>120.960</td>
      <td>120.960</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="stock-delistings">
<h3>Stock Delistings<a class="headerlink" href="#stock-delistings" title="Permalink to this heading">#</a></h3>
<p>An important feature of the CRSP database is that it is free of survivorship-bias.  It includes the historical records of stocks that have delisted from trading on the exchanges.</p>
<p>In CRSP Monthly, the Delisting Return is calculated from the last
month ending price to the last daily trading price if no other
delisting information is available. In this case the delisting
payment date is the same as the delisting date.  If the return is
calculated from a daily price, it is a partial-month return. The
partial-month returns are not truly Delisting Returns since they do
not represent values after delisting, but allow the researcher to
make a more accurate estimate of the Delisting Returns.</p>
<p>Following Bali, Engle, and Murray (2016) and Shumway (1997): we can
construct returns adjusted for delistings, which result when a
company is acquired, ceases operations, or fails to meet exchange
listing requirements. The adjustment reflects the partial month of
returns to investors who bought the stock in the month before the
delisting. For certain delisting codes ([500, 520, 551..574, 580,
584]) where the delisting return is missing, a delisting return of -30%
is assumed which reflects the average recovery amount after delisting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show sample of original CRSP Monthly ret and dlret, and after adjustment            </span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s1">&#39;select * from monthly where dlstcd&gt;100 and date=20041130&#39;</span><span class="p">,</span> <span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ret&#39;</span><span class="p">:</span> <span class="s1">&#39;original_ret&#39;</span><span class="p">})</span>\
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">crsp</span><span class="o">.</span><span class="n">get_ret</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="mi">20041101</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">20041130</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>\
  <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>prc</th>
      <th>original_ret</th>
      <th>retx</th>
      <th>dlstcd</th>
      <th>dlret</th>
      <th>ret</th>
    </tr>
    <tr>
      <th>permno</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10275</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>584</td>
      <td>-0.2703</td>
      <td>-0.2703</td>
    </tr>
    <tr>
      <th>10418</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>520</td>
      <td>0.0509</td>
      <td>0.0509</td>
    </tr>
    <tr>
      <th>11194</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0066</td>
      <td>0.0066</td>
    </tr>
    <tr>
      <th>12010</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>587</td>
      <td>0.0490</td>
      <td>0.0490</td>
    </tr>
    <tr>
      <th>20459</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>231</td>
      <td>0.0724</td>
      <td>0.0724</td>
    </tr>
    <tr>
      <th>32897</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>584</td>
      <td>-0.2357</td>
      <td>-0.2357</td>
    </tr>
    <tr>
      <th>55589</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>-0.0114</td>
      <td>-0.0114</td>
    </tr>
    <tr>
      <th>64290</th>
      <td>20041130</td>
      <td>13.70</td>
      <td>0.0178</td>
      <td>0.0178</td>
      <td>233</td>
      <td>0.0000</td>
      <td>0.0178</td>
    </tr>
    <tr>
      <th>67708</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0164</td>
      <td>0.0164</td>
    </tr>
    <tr>
      <th>69593</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>331</td>
      <td>0.0998</td>
      <td>0.0998</td>
    </tr>
    <tr>
      <th>69681</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>584</td>
      <td>-0.4853</td>
      <td>-0.4853</td>
    </tr>
    <tr>
      <th>70447</th>
      <td>20041130</td>
      <td>5.80</td>
      <td>-0.2246</td>
      <td>-0.2246</td>
      <td>570</td>
      <td>NaN</td>
      <td>-0.4572</td>
    </tr>
    <tr>
      <th>75606</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>520</td>
      <td>-0.2466</td>
      <td>-0.2466</td>
    </tr>
    <tr>
      <th>75684</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0094</td>
      <td>0.0094</td>
    </tr>
    <tr>
      <th>76306</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>241</td>
      <td>-0.0329</td>
      <td>-0.0329</td>
    </tr>
    <tr>
      <th>76691</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>582</td>
      <td>0.0127</td>
      <td>0.0127</td>
    </tr>
    <tr>
      <th>77838</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>520</td>
      <td>-0.0041</td>
      <td>-0.0041</td>
    </tr>
    <tr>
      <th>79149</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>574</td>
      <td>-0.2088</td>
      <td>-0.2088</td>
    </tr>
    <tr>
      <th>79523</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0043</td>
      <td>0.0043</td>
    </tr>
    <tr>
      <th>80211</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>470</td>
      <td>0.0186</td>
      <td>0.0186</td>
    </tr>
    <tr>
      <th>80714</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>332</td>
      <td>0.0337</td>
      <td>0.0337</td>
    </tr>
    <tr>
      <th>82491</th>
      <td>20041130</td>
      <td>4.21</td>
      <td>-0.0644</td>
      <td>-0.0644</td>
      <td>551</td>
      <td>0.0689</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>83583</th>
      <td>20041130</td>
      <td>125.10</td>
      <td>0.2810</td>
      <td>0.2810</td>
      <td>241</td>
      <td>0.0624</td>
      <td>0.3608</td>
    </tr>
    <tr>
      <th>83702</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>587</td>
      <td>0.2667</td>
      <td>0.2667</td>
    </tr>
    <tr>
      <th>83995</th>
      <td>20041130</td>
      <td>26.58</td>
      <td>0.2374</td>
      <td>0.2374</td>
      <td>231</td>
      <td>0.0394</td>
      <td>0.2861</td>
    </tr>
    <tr>
      <th>84047</th>
      <td>20041130</td>
      <td>16.35</td>
      <td>0.0467</td>
      <td>0.0467</td>
      <td>241</td>
      <td>-0.2661</td>
      <td>-0.2318</td>
    </tr>
    <tr>
      <th>86123</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0059</td>
      <td>0.0059</td>
    </tr>
    <tr>
      <th>86307</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0223</td>
      <td>0.0223</td>
    </tr>
    <tr>
      <th>86388</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>584</td>
      <td>-0.0337</td>
      <td>-0.0337</td>
    </tr>
    <tr>
      <th>86991</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0106</td>
      <td>0.0106</td>
    </tr>
    <tr>
      <th>87126</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>231</td>
      <td>0.0784</td>
      <td>0.0784</td>
    </tr>
    <tr>
      <th>87158</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0086</td>
      <td>0.0086</td>
    </tr>
    <tr>
      <th>87247</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0046</td>
      <td>0.0046</td>
    </tr>
    <tr>
      <th>88670</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>470</td>
      <td>0.0013</td>
      <td>0.0013</td>
    </tr>
    <tr>
      <th>89186</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>331</td>
      <td>0.0696</td>
      <td>0.0696</td>
    </tr>
    <tr>
      <th>89385</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>231</td>
      <td>0.2959</td>
      <td>0.2959</td>
    </tr>
    <tr>
      <th>89936</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>231</td>
      <td>0.0719</td>
      <td>0.0719</td>
    </tr>
    <tr>
      <th>89939</th>
      <td>20041130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>233</td>
      <td>0.0059</td>
      <td>0.0059</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="sql">
<h2>SQL<a class="headerlink" href="#sql" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>SQL: Structured query language (SQL) is a standard language for database creation and manipulation.</p></li>
<li><p>MySQL: A database management system, not a programming language, that uses structured query language (SQL) to manage data inside.</p></li>
<li><p>SQLAlchemy: A toolkit of Python SQL for using an SQL database.</p></li>
<li><p>pandas.read_sql(str, connection): Read SQL query or database table into a DataFrame.</p></li>
</ul>
<p>SQL Cheatsheet:</p>
<p><strong>Manage tables</strong></p>
<p>CREATE DATABASE – Creates a new database.</p>
<p>CREATE TABLE – Creates a new table.</p>
<p>DELETE – Delete data from a table.</p>
<p>DROP COLUMN – Deletes a column from a table.</p>
<p>DROP DATABASE – Deletes the entire database.</p>
<p>DROP TABLE – Deletes a table from a database.</p>
<p>TRUNCATE TABLE – Deletes the data but does not delete the table.</p>
<p><strong>Querying a table</strong></p>
<p>SELECT – Used to select data from a database, which is then returned in a results set.</p>
<p>SELECT DISTINCT – Sames as SELECT, except duplicate values are excluded.</p>
<p>SELECT INTO – Copies data from one table and inserts it into another.</p>
<p>UNIQUE – This constraint ensures all values in a column are unique.</p>
<p>FROM – Specifies which table to select or delete data from.</p>
<p>AS – Renames a table or column with an alias value which only exists for the duration of the query.</p>
<p><strong>Query conditions</strong></p>
<p>WHERE – Filters results to only include data which meets the given condition.</p>
<p>AND – Used to join separate conditions within a WHERE clause.</p>
<p>BETWEEN – Selects values within the given range.</p>
<p>IS NULL – Tests for empty (NULL) values.</p>
<p>IS NOT NULL – The reverse of NULL. Tests for values that aren’t empty / NULL.</p>
<p>LIKE – Returns true if the operand value matches a pattern.</p>
<p>NOT – Returns true if a record DOESN’T meet the condition.</p>
<p>OR – Used alongside WHERE to include data when either condition is true.</p>
<p><strong>Organize results</strong></p>
<p>ORDER BY – Used to sort the result data in ascending (default) or descending order through the use of ASC or DESC keywords.</p>
<p>GROUP BY – Used alongside aggregate functions (COUNT, MAX, MIN, SUM, AVG) to group the results.</p>
<p><strong>Join tables</strong></p>
<p>INNER JOIN returns rows that have matching values in both tables.</p>
<p>LEFT JOIN returns all rows from the left table, and the matching rows from the right table.-</p>
<p>RIGHT JOIN returns all rows from the right table, and the matching records from the left table</p>
<p>FULL OUTER JOIN returns all rows when there is a match in either left table or right table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># inner join of identifier tables</span>

<span class="c1"># double up the % in a pandas string</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;select * from benchident where name like &#39;</span><span class="si">%%</span><span class="s2">momentum</span><span class="si">%%</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>permno</th>
      <th>name</th>
      <th>item</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Mom</td>
      <td>F-F_Momentum_Factor_daily</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select * from benchident inner join benchmarks</span>
<span class="s2">on benchident.permno = benchmarks.permno</span>
<span class="s2">where benchident.name like &#39;</span><span class="si">%%</span><span class="s2">momentum</span><span class="si">%%</span><span class="s2">&#39;</span>
<span class="s2">  and benchident.permno like &#39;</span><span class="si">%%</span><span class="s2">(mo)</span><span class="si">%%</span><span class="s2">&#39;</span>
<span class="s2">limit 5</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">con</span><span class="o">=</span><span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>permno</th>
      <th>name</th>
      <th>item</th>
      <th>permno</th>
      <th>date</th>
      <th>ret</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
      <td>Mom(mo)</td>
      <td>19270131</td>
      <td>0.0036</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
      <td>Mom(mo)</td>
      <td>19270228</td>
      <td>-0.0214</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
      <td>Mom(mo)</td>
      <td>19270331</td>
      <td>0.0361</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
      <td>Mom(mo)</td>
      <td>19270430</td>
      <td>0.0430</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Mom(mo)</td>
      <td>F-F_Momentum_Factor</td>
      <td>0</td>
      <td>Mom(mo)</td>
      <td>19270531</td>
      <td>0.0300</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="properties-of-stock-returns">
<h2>Properties of stock returns<a class="headerlink" href="#properties-of-stock-returns" title="Permalink to this heading">#</a></h2>
<section id="long-run-market-averages">
<h3>Long-run Market Averages<a class="headerlink" href="#long-run-market-averages" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>total stock returns</p></li>
<li><p>dividend yield</p></li>
<li><p>shares trading turnover</p></li>
</ul>
<p>Equal-weighted time-series means of
annual cap-weighted cross-sectional averages of universe stocks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop over the 20-year eras, and compute means of annual cap-weighted averages</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1985</span><span class="p">,</span> <span class="mi">1965</span><span class="p">,</span> <span class="mi">1945</span><span class="p">,</span> <span class="mi">1925</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;divyld&#39;</span><span class="p">,</span> <span class="s1">&#39;turnover&#39;</span><span class="p">,</span> <span class="s1">&#39;means&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">era</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">years</span><span class="p">):</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">era</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">era</span><span class="o">+</span><span class="mi">20</span><span class="p">,</span> <span class="n">CRSP_DATE</span> <span class="o">//</span> <span class="mi">10000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">divyld</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">means</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">turnover</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">bd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">era</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">CRSP_DATE</span> <span class="o">//</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">era</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="n">univ</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">get_universe</span><span class="p">(</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>  <span class="c1"># screen for universe stocks</span>

        <span class="c1"># Retrieve and compute cap-weighted average of annual returns</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select permno, SUM(LOG(1+ret)) AS ret FROM daily</span>
<span class="s2">WHERE date &gt; </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2"> AND date &lt;= </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">GROUP BY permno</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">univ</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">means</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Retrieve and compute cap-weighted average of annualized turnover</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">select permno, 252*AVG(vol/(shrout*1000)) AS turnover FROM daily</span>
<span class="s2">WHERE date &gt; </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2"> AND date &lt;= </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">GROUP BY permno</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">univ</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">turnover</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Retrieve and compute cap-weighted average of annual dividend amounts</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT dist.permno as permno, SUM(daily.shrout * dist.divamt) AS divamt</span>
<span class="s2">FROM dist INNER JOIN daily</span>
<span class="s2">ON daily.permno = dist.permno AND daily.date = dist.exdt</span>
<span class="s2">WHERE dist.divamt &gt; 0 AND dist.exdt &gt; </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span>
<span class="s2">  AND dist.exdt &lt;= </span><span class="si">{</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>
<span class="s2">GROUP BY permno</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sql</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;permno&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">univ</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        <span class="n">divyld</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;divamt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cap&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;turnover&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">turnover</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;divyld&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">divyld</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="s1">&#39;means&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">means</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/5 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 5/5 [1:07:12&lt;00:00, 806.52s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot mean returns, dividend yield and turnover using both y-axes</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;means&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;divyld&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;average returns&#39;</span><span class="p">,</span> <span class="s1">&#39;dividend yield&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Annual dividend yield and total stock returns&quot;</span><span class="p">)</span>
<span class="n">bx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">bx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;turnover&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">bx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Annual Turnover&quot;</span><span class="p">)</span>
<span class="n">bx</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;turnover&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Long-Run Market Averages&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4ba96abf4438a98753a77b7f1c2275aa7c234a7d5f8a3636b950de8ad1fe0f0b.png" src="_images/4ba96abf4438a98753a77b7f1c2275aa7c234a7d5f8a3636b950de8ad1fe0f0b.png" />
</div>
</div>
</section>
<section id="moments-of-individual-stock-returns">
<h3>Moments of individual stock returns<a class="headerlink" href="#moments-of-individual-stock-returns" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The volatility of an asset is usually measured using the standard deviation of the returns. The common practice is to report the annualized volatility using the square-root rule which assumes that variance scales linearly with time: e.g.
daily by <span class="math notranslate nohighlight">\(\sqrt{252}\)</span>, weekly by <span class="math notranslate nohighlight">\(\sqrt{52}\)</span>, monthly by <span class="math notranslate nohighlight">\(\sqrt{12}\)</span></p></li>
<li><p>Means are computed from log returns, and annualized by multiplying by the respective number of periods in a year.  We use log returns <span class="math notranslate nohighlight">\(\log{1+R_t}\)</span> instead of simple returns <span class="math notranslate nohighlight">\(R_t\)</span> to skirt around some of the issues related to translating between arithmetic and geometric averages. It has been shown that:</p>
<ul>
<li><p>By Jensen’s inequality, the arithmetic mean is greater than the geometric mean</p></li>
<li><p>Under the assumption of log-normality, the arithmetic mean exceeds the geometric means of returns by half the volatility.</p></li>
</ul>
</li>
<li><p>A normal distribution is symmetric and thin-tailed, and so has no skewness or excess kurtosis. However, many return series are both skewed and fat-tailed (kurtosis in excess of 3).</p>
<ul>
<li><p>A left-skewed distribution is longer on the left side of its peak than on its right. In other words, a left-skewed distribution has a long tail on its left side. Left skew is also referred to as negative skew.</p></li>
<li><p>Right or positive skew has the opposite properties.</p></li>
</ul>
</li>
</ul>
<p>The Jarque-Bera test statistic can be used to test whether the sample skewness and kurtosis are compatible with an assumption that the returns are normally distributed. When returns are normally distributed, the skewness is asymptotically normally distributed with a variance of 6, so (skewness)<span class="math notranslate nohighlight">\(^2/6\)</span> has a <span class="math notranslate nohighlight">\(\chi^2_1\)</span>
distribution. Meanwhile, the kurtosis is asymptotically normally distributed with mean 3 and variance of 24, and so (kurtosis - 3)<span class="math notranslate nohighlight">\(^2/24\)</span> also has a <span class="math notranslate nohighlight">\(\chi^2_1\)</span>
distribution. These two statistics are
asymptotically independent (uncorrelated), and so their sum is <span class="math notranslate nohighlight">\(~\chi^2_2\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># helper function</span>
<span class="k">def</span> <span class="nf">get_moments</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">annualize</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;helper to summarize moments of individual stock returns&quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">years</span><span class="p">)</span>
    <span class="n">max_era</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">CRSP_DATE</span><span class="p">,</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="o">+</span> <span class="n">stride</span><span class="p">))</span> <span class="c1"># end year of last era</span>

    <span class="c1"># Use StocksBuffer to cache monthly returns for entire era</span>
    <span class="k">if</span> <span class="n">freq</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]:</span>
        <span class="n">monthly</span> <span class="o">=</span> <span class="n">CRSPBuffer</span><span class="p">(</span><span class="n">stocks</span><span class="o">=</span><span class="n">crsp</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">],</span>
                             <span class="n">beg</span><span class="o">=</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">years</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="n">max_era</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">era</span><span class="p">,</span> <span class="n">next_era</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">years</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="p">[</span><span class="n">max_era</span><span class="p">]):</span>
        <span class="n">allstocks</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">anystocks</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">univ_year</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">era</span><span class="p">)</span>  <span class="c1"># universe as of end of previous calendar year</span>

        <span class="c1"># Loop over calendar years in era</span>
        <span class="n">endyrs</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">era</span><span class="p">),</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">next_era</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">beg</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">bd</span><span class="o">.</span><span class="n">date_tuples</span><span class="p">(</span><span class="n">endyrs</span><span class="p">)):</span>
            
            <span class="c1"># Update the investment universe every calendar year</span>
            <span class="k">if</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">beg</span><span class="p">)</span> <span class="o">!=</span> <span class="n">univ_year</span><span class="p">:</span>
                <span class="n">univ</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">get_universe</span><span class="p">(</span><span class="n">univ_year</span><span class="p">)</span>
                <span class="n">univ_year</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">beg</span><span class="p">)</span>

                <span class="c1"># Use StocksBuffer to cache daily returns for the calendar year</span>
                <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                    <span class="n">daily</span> <span class="o">=</span> <span class="n">CRSPBuffer</span><span class="p">(</span><span class="n">stocks</span><span class="o">=</span><span class="n">crsp</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ret&#39;</span><span class="p">],</span>
                                       <span class="n">beg</span><span class="o">=</span><span class="n">bd</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="n">bd</span><span class="o">.</span><span class="n">endyr</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>
                    
            <span class="c1"># retrieve returns</span>
            <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">get_ret</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">univ</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">crsp</span><span class="o">.</span><span class="n">get_ret</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">univ</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>    <span class="c1"># monthly or coarser</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">monthly</span><span class="o">.</span><span class="n">get_ret</span><span class="p">(</span><span class="n">beg</span><span class="o">=</span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">univ</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

            <span class="c1"># horizontally stack returns</span>
            <span class="k">if</span> <span class="n">allstocks</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">allstocks</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">end</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>   <span class="c1"># every year                 </span>
                <span class="n">allstocks</span> <span class="o">=</span> <span class="n">allstocks</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
            <span class="n">anystocks</span> <span class="o">=</span> <span class="n">anystocks</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">end</span><span class="p">),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>  <span class="c1"># any year</span>

        <span class="n">anystocks</span> <span class="o">=</span> <span class="n">anystocks</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>        <span class="c1"># drop empty rows    </span>
        <span class="n">out</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">era</span><span class="p">)[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">next_era</span><span class="p">)[:</span><span class="mi">4</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;VolAnnualized&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">allstocks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">annualize</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;Skewness&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span>
                <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">allstocks</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
            <span class="sa">f</span><span class="s2">&quot;ExcessKurtosis&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span>
                <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">allstocks</span><span class="p">,</span> <span class="n">nan_policy</span><span class="o">=</span><span class="s1">&#39;omit&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
            <span class="sa">f</span><span class="s2">&quot;Count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">allstocks</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;MeanAnnualized&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">allstocks</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">annualize</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Mean (all stocks)&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">anystocks</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">annualize</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;Count (all stocks)&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">anystocks</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Collect results for different intervals and eras</span>
<span class="n">intervals</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;weekly&#39;</span><span class="p">,</span> <span class="mi">52</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
             <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="s1">&#39;annual&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>          <span class="c1"># different returns sampling frequencies</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1985</span><span class="p">,</span> <span class="mi">1965</span><span class="p">,</span> <span class="mi">1945</span><span class="p">,</span> <span class="mi">1925</span><span class="p">]</span>   <span class="c1"># 20-year periods</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
<span class="c1">#results = pd.read_json(outdir / &#39;moments.json&#39;)</span>
<span class="c1">#results = results.set_index(results.columns[0])</span>
<span class="k">for</span> <span class="n">order</span><span class="p">,</span> <span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">annualize</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">get_moments</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">annualize</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">20</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;interval&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span>

    <span class="c1"># set index so that rows can be ordered by moment then freq</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">moment</span><span class="si">}{</span><span class="n">order</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">moment</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">results</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>  <span class="c1"># accumulate df to results</span>
    <span class="n">results</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">outdir</span> <span class="o">/</span> <span class="s1">&#39;moments.json&#39;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;moment&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show medians of moments of individual stock returns</span>
<span class="n">out</span><span class="p">[</span><span class="o">~</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="o">~</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Mean&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="s1">&#39;moment&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>1925-1944</th>
      <th>1945-1964</th>
      <th>1965-1984</th>
      <th>1985-2004</th>
      <th>2005-2022</th>
    </tr>
    <tr>
      <th>interval</th>
      <th>moment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>daily</th>
      <th>VolAnnualized</th>
      <td>0.543</td>
      <td>0.267</td>
      <td>0.337</td>
      <td>0.392</td>
      <td>0.437</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>VolAnnualized</th>
      <td>0.540</td>
      <td>0.254</td>
      <td>0.347</td>
      <td>0.366</td>
      <td>0.407</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>VolAnnualized</th>
      <td>0.553</td>
      <td>0.244</td>
      <td>0.340</td>
      <td>0.355</td>
      <td>0.381</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>VolAnnualized</th>
      <td>0.553</td>
      <td>0.296</td>
      <td>0.382</td>
      <td>0.379</td>
      <td>0.360</td>
    </tr>
    <tr>
      <th>daily</th>
      <th>Skewness</th>
      <td>0.909</td>
      <td>0.315</td>
      <td>0.528</td>
      <td>0.339</td>
      <td>0.395</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>Skewness</th>
      <td>0.932</td>
      <td>0.528</td>
      <td>0.627</td>
      <td>0.343</td>
      <td>0.281</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>Skewness</th>
      <td>1.257</td>
      <td>0.484</td>
      <td>0.597</td>
      <td>0.381</td>
      <td>0.307</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>Skewness</th>
      <td>0.751</td>
      <td>0.582</td>
      <td>0.628</td>
      <td>0.684</td>
      <td>0.423</td>
    </tr>
    <tr>
      <th>daily</th>
      <th>ExcessKurtosis</th>
      <td>14.887</td>
      <td>5.446</td>
      <td>4.926</td>
      <td>8.749</td>
      <td>13.268</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>ExcessKurtosis</th>
      <td>7.535</td>
      <td>2.645</td>
      <td>2.916</td>
      <td>4.384</td>
      <td>6.589</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>ExcessKurtosis</th>
      <td>6.073</td>
      <td>1.074</td>
      <td>1.648</td>
      <td>2.080</td>
      <td>2.306</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>ExcessKurtosis</th>
      <td>0.220</td>
      <td>-0.115</td>
      <td>0.105</td>
      <td>0.132</td>
      <td>-0.051</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show counts of stocks</span>
<span class="n">out</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="s1">&#39;moment&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>1925-1944</th>
      <th>1945-1964</th>
      <th>1965-1984</th>
      <th>1985-2004</th>
      <th>2005-2022</th>
    </tr>
    <tr>
      <th>interval</th>
      <th>moment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>daily</th>
      <th>Count</th>
      <td>305</td>
      <td>606</td>
      <td>877</td>
      <td>1219</td>
      <td>1579</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>Count</th>
      <td>305</td>
      <td>606</td>
      <td>877</td>
      <td>1219</td>
      <td>1579</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>Count</th>
      <td>305</td>
      <td>606</td>
      <td>877</td>
      <td>1219</td>
      <td>1579</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>Count</th>
      <td>305</td>
      <td>606</td>
      <td>877</td>
      <td>1219</td>
      <td>1579</td>
    </tr>
    <tr>
      <th>daily</th>
      <th>Count (all stocks)</th>
      <td>1082</td>
      <td>2448</td>
      <td>10089</td>
      <td>16273</td>
      <td>9050</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>Count (all stocks)</th>
      <td>1082</td>
      <td>2447</td>
      <td>10084</td>
      <td>16271</td>
      <td>9042</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>Count (all stocks)</th>
      <td>1082</td>
      <td>2448</td>
      <td>10088</td>
      <td>16273</td>
      <td>9049</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>Count (all stocks)</th>
      <td>1082</td>
      <td>2448</td>
      <td>10088</td>
      <td>16273</td>
      <td>9049</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show medians of mean individual stock returns</span>
<span class="n">out</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;moment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Mean&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;interval&#39;</span><span class="p">,</span> <span class="s1">&#39;moment&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>1925-1944</th>
      <th>1945-1964</th>
      <th>1965-1984</th>
      <th>1985-2004</th>
      <th>2005-2022</th>
    </tr>
    <tr>
      <th>interval</th>
      <th>moment</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>daily</th>
      <th>MeanAnnualized</th>
      <td>0.040</td>
      <td>0.104</td>
      <td>0.089</td>
      <td>0.099</td>
      <td>0.059</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>MeanAnnualized</th>
      <td>0.046</td>
      <td>0.109</td>
      <td>0.087</td>
      <td>0.100</td>
      <td>0.057</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>MeanAnnualized</th>
      <td>0.047</td>
      <td>0.108</td>
      <td>0.088</td>
      <td>0.099</td>
      <td>0.059</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>MeanAnnualized</th>
      <td>0.047</td>
      <td>0.108</td>
      <td>0.088</td>
      <td>0.099</td>
      <td>0.059</td>
    </tr>
    <tr>
      <th>daily</th>
      <th>Mean (all stocks)</th>
      <td>0.052</td>
      <td>0.114</td>
      <td>0.059</td>
      <td>0.009</td>
      <td>0.006</td>
    </tr>
    <tr>
      <th>weekly</th>
      <th>Mean (all stocks)</th>
      <td>0.061</td>
      <td>0.118</td>
      <td>0.057</td>
      <td>0.010</td>
      <td>0.004</td>
    </tr>
    <tr>
      <th>monthly</th>
      <th>Mean (all stocks)</th>
      <td>0.063</td>
      <td>0.118</td>
      <td>0.059</td>
      <td>0.009</td>
      <td>0.007</td>
    </tr>
    <tr>
      <th>annual</th>
      <th>Mean (all stocks)</th>
      <td>0.061</td>
      <td>0.116</td>
      <td>0.056</td>
      <td>0.008</td>
      <td>0.006</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="correlations">
<h3>Correlations<a class="headerlink" href="#correlations" title="Permalink to this heading">#</a></h3>
<p>The linear correlation estimator (also known as Pearson’s correlation) measures the linear relationship between two variables. Alternative measures can help capture nonlinear dependence:</p>
<ul class="simple">
<li><p>rank correlation (or Spearman’s correlation) is the linear correlation estimator applied to the ranks of the observations. It measures monotoric correlation and is less sensitive to outliers.</p></li>
<li><p>Kendall’s <span class="math notranslate nohighlight">\(\tau\)</span> measures the relative frequency of concordant and discordant pairs of two random variables X and Y. Concordant pairs agree about the relative position of X and Y, while pairs that disagree about the order are discordant. This statistic is robust to outliers and works well with skewed or non-normally distributed data.</p></li>
</ul>
<p>Computing these measures between the value-weighted and equal-weighted total daily market returns suggests that the high estimated linear correlation may be sensitive to outliers, compared to estimators that are less.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve CRSP value- and equal-weighted total market returns</span>
<span class="n">retd</span> <span class="o">=</span> <span class="n">bench</span><span class="o">.</span><span class="n">get_series</span><span class="p">([</span><span class="s1">&#39;vwretd&#39;</span><span class="p">,</span> <span class="s1">&#39;ewretd&#39;</span><span class="p">],</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;ret&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">retd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>permno</th>
      <th>vwretd</th>
      <th>ewretd</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19260102</th>
      <td>0.004297</td>
      <td>0.002941</td>
    </tr>
    <tr>
      <th>19260104</th>
      <td>-0.001357</td>
      <td>0.001036</td>
    </tr>
    <tr>
      <th>19260105</th>
      <td>-0.004603</td>
      <td>-0.005856</td>
    </tr>
    <tr>
      <th>19260106</th>
      <td>0.000537</td>
      <td>0.000888</td>
    </tr>
    <tr>
      <th>19260107</th>
      <td>0.003907</td>
      <td>0.004258</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20231222</th>
      <td>0.001708</td>
      <td>0.003380</td>
    </tr>
    <tr>
      <th>20231226</th>
      <td>0.004208</td>
      <td>0.005969</td>
    </tr>
    <tr>
      <th>20231227</th>
      <td>0.001604</td>
      <td>0.001316</td>
    </tr>
    <tr>
      <th>20231228</th>
      <td>0.000415</td>
      <td>0.001506</td>
    </tr>
    <tr>
      <th>20231229</th>
      <td>-0.002798</td>
      <td>-0.003538</td>
    </tr>
  </tbody>
</table>
<p>25798 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute alternative measures of correlation</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">kendall</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">kendalltau</span><span class="p">(</span><span class="n">retd</span><span class="p">[</span><span class="s1">&#39;vwretd&#39;</span><span class="p">],</span> <span class="n">retd</span><span class="p">[</span><span class="s1">&#39;ewretd&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">spearman</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">retd</span><span class="p">[</span><span class="s1">&#39;vwretd&#39;</span><span class="p">],</span> <span class="n">retd</span><span class="p">[</span><span class="s1">&#39;ewretd&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
               <span class="n">pearson</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">retd</span><span class="p">[</span><span class="s1">&#39;vwretd&#39;</span><span class="p">],</span> <span class="n">retd</span><span class="p">[</span><span class="s1">&#39;ewretd&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]),</span>
               <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Alternative measures of correlations&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>kendall</th>
      <th>spearman</th>
      <th>pearson</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alternative measures of correlations</th>
      <td>0.8147</td>
      <td>0.9462</td>
      <td>0.9628</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="id1">
<h2>Stock Delistings<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h2>
<p>An important feature of the CRSP database is that it is free of survivorship-bias.  It includes the historical records of stocks that have delisted from trading on the exchanges.</p>
<p>In CRSP Monthly, the Delisting Return is calculated from the last
month ending price to the last daily trading price if no other
delisting information is available. In this case the delisting
payment date is the same as the delisting date.  If the return is
calculated from a daily price, it is a partial-month return. The
partial-month returns are not truly Delisting Returns since they do
not represent values after delisting, but allow the researcher to
make a more accurate estimate of the Delisting Returns.</p>
<p>Following Bali, Engle, and Murray (2016) and Shumway (1997): we can
construct returns adjusted for delistings, which result when a
company is acquired, ceases operations, or fails to meet exchange
listing requirements. The adjustment reflects the partial month of
returns to investors who bought the stock in the month before the
delisting. For certain delisting codes ([500, 520, 551..574, 580,
584]) where the delisting return is missing, a delisting return of -30%
is assumed which reflects the average recovery amount after delisting.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="README.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">FINANCIAL DATA SCIENCE</p>
      </div>
    </a>
    <a class="right-next"
       href="jegadeesh_titman.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Jegadeesh-Titman Rolling Portfolios</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#universe-selection">Universe selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-stock-returns">Measuring Stock Returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieve-yahoo-finance-prices">Retrieve Yahoo Finance prices</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-splits-and-dividends">Stock Splits and Dividends</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-delistings">Stock Delistings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sql">SQL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties-of-stock-returns">Properties of stock returns</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#long-run-market-averages">Long-run Market Averages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moments-of-individual-stock-returns">Moments of individual stock returns</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlations">Correlations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Stock Delistings</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Terence Lim
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>