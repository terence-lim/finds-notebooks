

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Conditional Volatility and VaR &#8212; Financial Data Science Python Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'conditional_volatility';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Covariance Matrix" href="covariance_matrix.html" />
    <link rel="prev" title="Bond Returns and Risks" href="bond_returns.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
  
    <p class="title logo__title">Financial Data Science Python Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    FINANCIAL DATA SCIENCE
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="stock_prices.html">Stock Prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="jegadeesh_titman.html">Jegadeesh-Titman Rolling Portfolios</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_french.html">Fama-French Portfolio Sorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_macbeth.html">Fama-Macbeth Cross-sectional Regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="weekly_reversal.html">Contrarian Trading</a></li>
<li class="toctree-l1"><a class="reference internal" href="quant_factors.html">Quant Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_study.html">Event Study</a></li>
<li class="toctree-l1"><a class="reference internal" href="economic_releases.html">Economic Data Revisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_diagnostics.html">Linear Regression Diagonostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econometric_forecast.html">Econometric Forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="approximate_factors.html">Approximate Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="economic_states.html">State Space Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="term_structure.html">Term Structure of Interest Rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="bond_returns.html">Bond Returns and Risks</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Conditional Volatility and VaR</a></li>
<li class="toctree-l1"><a class="reference internal" href="covariance_matrix.html">Covariance Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="options_pricing.html">Options Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="market_microstructure.html">Market Microstructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_risk.html">Event Risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer_ego.html">Principal Customers Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="industry_community.html">Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="bea_centrality.html">Graph Centrality</a></li>
<li class="toctree-l1"><a class="reference internal" href="link_prediction.html">Link Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial_regression.html">Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_topics.html">FOMC Topic Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="management_sentiment.html">Management Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="business_description.html">Business Text Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification_models.html">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_models.html">Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_classifier.html">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="recurrent_net.html">Recurrent Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="convolutional_net.html">Convolutional Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="reinforcement_learning.html">Reinforcement Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_language.html">FedSpeak Language Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="sentiment_llm.html">LLM Prompting</a></li>
<li class="toctree-l1"><a class="reference internal" href="summarization_llm.html">LLM Text Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="finetune_llm.html">LLM Finetuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="rag_agent.html">RAG, Chatbots and Agents</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git/issues/new?title=Issue%20on%20page%20%2Fconditional_volatility.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/conditional_volatility.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Conditional Volatility and VaR</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#value-at-risk">Value at Risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coherence">Coherence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametric-method">Parametric method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-normal-method">Delta-Normal method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation-method">Monte Carlo Simulation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-simulation-method">Historical Simulation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stressed-var-method">Stressed VaR method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-method">Bootstrap method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-volatility-models">Conditional volatility models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ewma-model">EWMA model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#garch-model">GARCH model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backtesting-var">Backtesting VaR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kupiec-likelihood-ratio-test">Kupiec Likelihood Ratio test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-coverage-tests">Conditional coverage tests</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="conditional-volatility-and-var">
<h1>Conditional Volatility and VaR<a class="headerlink" href="#conditional-volatility-and-var" title="Permalink to this heading">#</a></h1>
<p><em>The only constant in life is change</em> - Heraclitus</p>
<p>Concepts:</p>
<ul class="simple">
<li><p>Value at Risk</p></li>
<li><p>Coherence and Expected Shortfall</p></li>
<li><p>Cryptocurrency Indices</p></li>
<li><p>Historical Simulation and Stressed VaR</p></li>
<li><p>Bootstrapping</p></li>
<li><p>EWMA and GARCH</p></li>
<li><p>Backtesting VaR</p></li>
</ul>
<p>References:</p>
<ul class="simple">
<li><p>Jorion, Phillippe. Value at Risk.</p></li>
<li><p>P. Artzner, F. Delbaen, J.-M. Eber, and D. Heath, “Coherent Measures of Risk”, Mathematical Finance 9 (1999): 203–228.</p></li>
<li><p>Kupiec, P. (1995). Techniques for Verifying the Accuracy of Risk Measurement Models. Journal of Derivatives, 3, 73-84.</p></li>
<li><p>FRM Part I Exam Book Ch. 1-3</p></li>
<li><p>FRM Part II Exam Book Market Risk Measurement and Management Ch. 1-2</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">finds.readers</span> <span class="kn">import</span> <span class="n">Alfred</span>
<span class="kn">from</span> <span class="nn">finds.utils</span> <span class="kn">import</span> <span class="n">row_formatted</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">credentials</span>
<span class="c1">#pd.set_option(&#39;display.max_rows&#39;, None)</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1">#%matplotlib qt</span>
</pre></div>
</div>
</div>
</div>
<section id="value-at-risk">
<h2>Value at Risk<a class="headerlink" href="#value-at-risk" title="Permalink to this heading">#</a></h2>
<p>Value at Risk (VaR) is an important risk measure that focuses on adverse events and their probability. A VaR with a confidence level  of <em>alpha</em>% is found by searching for the loss that has an <em>alpha</em>% chance of being exceeded.</p>
<section id="coherence">
<h3>Coherence<a class="headerlink" href="#coherence" title="Permalink to this heading">#</a></h3>
<p>One problem with VaR is that it does not say anything about how bad losses might be when they exceed the VaR level. Furthermore, Artzner et al. proposed four properties a risk measure should have.</p>
<ol class="arabic simple">
<li><p>Monotonicity: If (regardless of what happens) a portfolio always produces a worse result than another portfolio, it should have a higher risk measure.</p></li>
<li><p>Translation Invariance: If an amount of cash K is added to a portfolio, its risk measure should decrease by K.</p></li>
<li><p>Homogeneity: Changing the size of a portfolio by multiplying the amounts of all the components by X results in the risk measure being multiplied by X.</p></li>
<li><p>Subadditivity: For any two portfolios, the risk measure for the portfolio formed by merging them should be no greater than the sum of the risk measures for the portfolios.</p></li>
</ol>
<p>A risk measure that satisfies all four conditions is termed coherent. <strong>Expected shortfall</strong> (ES) has all four properties, while VaR has only the first three properties. ES is computed as the probability-weighted average of tail losses.  Other coherent risk measures can be derived by applying a risk aversion function to weight the quantiles. ES is a special case where the risk aversion weights are equal for all tail-loss quantiles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># retrieve crypto currency index from FRED, as log returns</span>
<span class="n">alf</span> <span class="o">=</span> <span class="n">Alfred</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;fred&#39;</span><span class="p">][</span><span class="s1">&#39;api_key&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">convert_date</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">alf</span><span class="o">.</span><span class="n">get_category</span><span class="p">(</span><span class="mi">33913</span><span class="p">)</span>
<span class="n">cryptos</span> <span class="o">=</span> <span class="p">[</span><span class="n">alf</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">diff</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;DISCONT&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]]</span>
<span class="n">cryptos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">titles</span> <span class="o">=</span> <span class="n">Series</span><span class="p">({</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]:</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
                 <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">cat</span><span class="p">[</span><span class="s1">&#39;series&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;DISCONT&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]},</span>
                <span class="n">name</span><span class="o">=</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># crypto index names</span>
<span class="n">titles</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">cat</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cryptocurrencies</th>
    </tr>
    <tr>
      <th>33913</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CBBCHUSD</th>
      <td>Coinbase Bitcoin Cash</td>
    </tr>
    <tr>
      <th>CBBTCUSD</th>
      <td>Coinbase Bitcoin</td>
    </tr>
    <tr>
      <th>CBETHUSD</th>
      <td>Coinbase Ethereum</td>
    </tr>
    <tr>
      <th>CBLTCUSD</th>
      <td>Coinbase Litecoin</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># recent crypto log returns</span>
<span class="n">cryptos</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2024-04-11</th>
      <td>-0.020373</td>
      <td>-0.007875</td>
      <td>-0.010817</td>
      <td>0.024184</td>
    </tr>
    <tr>
      <th>2024-04-12</th>
      <td>-0.141308</td>
      <td>-0.042222</td>
      <td>-0.080178</td>
      <td>-0.138679</td>
    </tr>
    <tr>
      <th>2024-04-13</th>
      <td>-0.104275</td>
      <td>-0.046878</td>
      <td>-0.070173</td>
      <td>-0.104611</td>
    </tr>
    <tr>
      <th>2024-04-14</th>
      <td>0.084578</td>
      <td>0.024820</td>
      <td>0.043828</td>
      <td>0.025499</td>
    </tr>
    <tr>
      <th>2024-04-15</th>
      <td>-0.031220</td>
      <td>-0.035412</td>
      <td>-0.016538</td>
      <td>-0.018678</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="parametric-method">
<h3>Parametric method<a class="headerlink" href="#parametric-method" title="Permalink to this heading">#</a></h3>
<p>Under the assumption that returns normally distributed, VaR and ES at the confidence level <em>alpha</em> is:</p>
<div class="math notranslate nohighlight">
\[VaR = -\mu + \sigma z_{1-\alpha}\]</div>
<div class="math notranslate nohighlight">
\[ES = -\mu + \sigma \dfrac{\exp(-z_{1-\alpha}^2/2)}{(1 - \alpha)\sqrt{2 \pi}}\]</div>
<p>where <span class="math notranslate nohighlight">\(z_{\alpha}\)</span> is the standard normal variate corresponding to <em>alpha</em>.</p>
<p>For example, with <em>alpha</em> = 0.95, <span class="math notranslate nohighlight">\(z_{\alpha} =\)</span> -1.645 which is the value whose cdf is the bottom 5% tail. In practice, <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> are not known and must be estimated. Since means are measured less precisely than volatility, and the returns are observed at short intervals, <span class="math notranslate nohighlight">\(\mu\)</span> is often assumed to be 0.</p>
<p>The normal probability distribution has skewness (third central moment) equal to zero and kurtosis (fourth central moment) equal to 3. Under the assumption that geometric returns are normally distributed, then arithmetic returns have a <strong>lognormal distributed</strong>. The skewness of the lognormal is
<span class="math notranslate nohighlight">\((\exp(\sigma^2) + 2)\sqrt{(\exp(\sigma^2) - 1)}\)</span>, and is always positive, hence the lognormal has a long right-tail. The lognormal has kurtosis
<span class="math notranslate nohighlight">\(\exp(\sigma^2)^4 + 2\exp(\sigma^2)^3 + 3\exp(\sigma^2)^2 -3\)</span> which varies from a minimum of over 3, and hence exhibits fatter tails than the normal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper to compute parametric VaR and ES</span>
<span class="k">def</span> <span class="nf">parametric_risk</span><span class="p">(</span><span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Series</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculate parametric gaussian VaR and ES&quot;&quot;&quot;</span>
    <span class="n">var</span> <span class="o">=</span> <span class="o">-</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="n">es</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value_at_risk</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">expected_shortfall</span><span class="o">=</span><span class="n">es</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.95</span>
<span class="n">volatility</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">])</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">}</span>
<span class="n">parametric</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="n">label</span><span class="p">:</span> <span class="n">Series</span><span class="p">(</span><span class="n">parametric_risk</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">std</span> <span class="ow">in</span> <span class="n">volatility</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parametric Risk Measures (alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;volatility&#39;</span><span class="p">:</span> <span class="n">volatility</span><span class="p">},</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
           <span class="n">parametric</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Parametric Risk Measures (alpha=0.95)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>volatility</th>
      <td>0.0597</td>
      <td>0.0407</td>
      <td>0.0520</td>
      <td>0.0557</td>
    </tr>
    <tr>
      <th>value_at_risk</th>
      <td>0.0982</td>
      <td>0.0669</td>
      <td>0.0855</td>
      <td>0.0916</td>
    </tr>
    <tr>
      <th>expected_shortfall</th>
      <td>0.1232</td>
      <td>0.0839</td>
      <td>0.1072</td>
      <td>0.1149</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="delta-normal-method">
<h3>Delta-Normal method<a class="headerlink" href="#delta-normal-method" title="Permalink to this heading">#</a></h3>
<p>This model is used to provide an approximate results for non-linear portfolios. The underlying assets or risk factors are modeled with a normal distribution. The risk of a portfolio, which may exhibit non-linear payoffs with options securities, is modeled by its delta, or the instantaneous rate of change in its value with respect to the rate of change in the underlying. A better approximation includes the second derivative of the portfolio value with the underlying assets or risk factors, called the delta-gamma method.</p>
</section>
<section id="monte-carlo-simulation-method">
<h3>Monte Carlo Simulation method<a class="headerlink" href="#monte-carlo-simulation-method" title="Permalink to this heading">#</a></h3>
<p>Monte Carlo simulation works for both linear and non-linear portfolios.
This method generates scenarios by taking random samples from the normal (or other theoretical) distribution assumed for the underlying assets or risk factors. Suppose 1000 MC scenarios are simulated: the VaR with <em>alpha</em> = 95% confidence will be the 50th (i.e. 5th percentile) worst loss and expected shortfall is the average of the 49 losses worse than this.</p>
<p>However, simple models based on Gaussian and independence assumptions may not be appropriate for the data sample, requiring the consideration of <strong>non-parametric</strong> approaches.</p>
<p>The QQ plot compare the distribution of the data sample to a reference normal distribution. The plot would appear linear when the observed quantiles are close to the theoretical quantiles. If the empirical distribution has heavier tails than the reference distribution, the QQ plot will have steeper slopes at its tails.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># QQ Plot for Gaussian assumption</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.gofplots</span> <span class="kn">import</span> <span class="n">ProbPlot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">ProbPlot</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">qqplot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span>
    <span class="n">sm</span><span class="o">.</span><span class="n">qqline</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s1">&#39;45&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Crypto Returns&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/terence/env3.11/lib/python3.11/site-packages/statsmodels/graphics/gofplots.py:1045: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &quot;b&quot; (-&gt; color=(0.0, 0.0, 1.0, 1)). The keyword argument will take precedence.
  ax.plot(x, y, fmt, **plot_style)
</pre></div>
</div>
<img alt="_images/6b9df993f8a4aac3a989a2cedbbe4222d66f9eb283ae36135886075e8372bfd2.png" src="_images/6b9df993f8a4aac3a989a2cedbbe4222d66f9eb283ae36135886075e8372bfd2.png" />
</div>
</div>
<p>Lagplot of daily returns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Autocorrelation of returns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">lag_plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">intercept</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">slope</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Crypto Returns&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8fe6e6576187a16469f32e74132ad7d283e7f60fb6e8831ff8f9f492b2ff621b.png" src="_images/8fe6e6576187a16469f32e74132ad7d283e7f60fb6e8831ff8f9f492b2ff621b.png" />
</div>
</div>
<p>Lagplot of squared daily returns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Autocorrelation of squared returns</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">plotting</span><span class="o">.</span><span class="n">lag_plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axline</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">intercept</span><span class="p">),</span> <span class="n">slope</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">slope</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">titles</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Crypto Squared Returns&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c1db1f8ee9cf76a240b9b6b0f6a8f1e0196295a465582f30b6d17c19a351d559.png" src="_images/c1db1f8ee9cf76a240b9b6b0f6a8f1e0196295a465582f30b6d17c19a351d559.png" />
</div>
</div>
</section>
<section id="historical-simulation-method">
<h3>Historical Simulation method<a class="headerlink" href="#historical-simulation-method" title="Permalink to this heading">#</a></h3>
<p>The simplest non-parametric approach to estimate VaR is by means of historical simulation (HS). The HS approach estimates VaR by ordering the loss observations and reading off the required VaR quantile. Expected shortfall is computed by averaging the observations smaller than that quantile.  Since non-parametric approaches do not depend on  assumptions about the model distribution, they can accommodate fat tails, skewness, and any other non-normal features that can cause problems for parametric approaches. However, non-parametric approaches are affected by how representative of data sample is of the period to be measured.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper to compute VaR, ES and sample moments from historical simulation</span>
<span class="k">def</span> <span class="nf">historical_risk</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate historical VaR, ES, and sample moments&quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">))</span>
    <span class="n">es</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">X</span> <span class="o">&lt;</span> <span class="n">var</span><span class="p">])</span>
    <span class="n">vol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">skew</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">kurt</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">kurtosis</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">jb</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">jbp</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">X</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">,</span> <span class="n">value_at_risk</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">expected_shortfall</span><span class="o">=</span><span class="n">es</span><span class="p">,</span> <span class="n">volatility</span><span class="o">=</span><span class="n">vol</span><span class="p">,</span>
                <span class="n">skewness</span><span class="o">=</span><span class="n">skew</span><span class="p">,</span> <span class="n">excess_kurtosis</span><span class="o">=</span><span class="n">kurt</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">jb_statistic</span><span class="o">=</span><span class="n">jb</span><span class="p">,</span> <span class="n">jb_pvalue</span><span class="o">=</span><span class="n">jbp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hist</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="n">label</span><span class="p">:</span> <span class="n">historical_risk</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Historical Risk Measures (alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">row_formatted</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Historical Risk Measures (alpha=0.95)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>N</th>
      <td>2302</td>
      <td>3388</td>
      <td>2886</td>
      <td>2796</td>
    </tr>
    <tr>
      <th>value_at_risk</th>
      <td>0.0844</td>
      <td>0.0606</td>
      <td>0.0764</td>
      <td>0.0836</td>
    </tr>
    <tr>
      <th>expected_shortfall</th>
      <td>0.0082</td>
      <td>0.0031</td>
      <td>0.0054</td>
      <td>0.0064</td>
    </tr>
    <tr>
      <th>volatility</th>
      <td>0.0597</td>
      <td>0.0407</td>
      <td>0.052</td>
      <td>0.0557</td>
    </tr>
    <tr>
      <th>skewness</th>
      <td>-0.2437</td>
      <td>-1.8572</td>
      <td>-0.4497</td>
      <td>0.7674</td>
    </tr>
    <tr>
      <th>excess_kurtosis</th>
      <td>12.8465</td>
      <td>51.3866</td>
      <td>5.8203</td>
      <td>10.2764</td>
    </tr>
    <tr>
      <th>jb_statistic</th>
      <td>24108.4383</td>
      <td>419504.1796</td>
      <td>9452.3917</td>
      <td>20809.0086</td>
    </tr>
    <tr>
      <th>jb_pvalue</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="stressed-var-method">
<h3>Stressed VaR method<a class="headerlink" href="#stressed-var-method" title="Permalink to this heading">#</a></h3>
<p>Volatilities increase during stressed market conditions, and  correlations also generally increase. It is sometimes stated that “in stressed markets all correlations go to one.” In periods of heightened volatility such as the Great Financial Crisis of 2008, correlations can be quite different from those in normal market conditions. This is sometimes referred to as a correlation break-down. When concerned with estimating what will happen in extreme market conditions, VaR or ES should be estimated based what correlations will be in such conditions rather than in normal market conditions.</p>
<p>Stress testing is designed to identify vulnerabilities, particularly those involving high volatility. <strong>Stressed VaR</strong> is computed based on a “stressed” historical period in the markets, as opposed to simply the most recent number of years, to get an idea of possible losses given worse market conditions. For example, the period from Nov 2021 through November 21, 2022 has been dubbed the “crypto winter”, culminating with collapse of the FTX crypto exchange.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">beg</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;2021-11-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2022-11-21&#39;</span>  <span class="c1"># dubbed &quot;crypto winter&quot;</span>
<span class="n">stress</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="n">label</span><span class="p">:</span> <span class="n">historical_risk</span><span class="p">(</span><span class="n">cryptos</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stressed Risk Measures (</span><span class="si">{</span><span class="n">beg</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">row_formatted</span><span class="p">(</span><span class="n">stress</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;(alpha=0.05)&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stressed Risk Measures (2021-11-01 to 2022-11-21)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>(alpha=0.05)</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>N</th>
      <td>386</td>
      <td>386</td>
      <td>386</td>
      <td>386</td>
    </tr>
    <tr>
      <th>value_at_risk</th>
      <td>0.0818</td>
      <td>0.0624</td>
      <td>0.0773</td>
      <td>0.0911</td>
    </tr>
    <tr>
      <th>expected_shortfall</th>
      <td>0.0078</td>
      <td>0.0058</td>
      <td>0.0074</td>
      <td>0.0053</td>
    </tr>
    <tr>
      <th>volatility</th>
      <td>0.0464</td>
      <td>0.0348</td>
      <td>0.0461</td>
      <td>0.0478</td>
    </tr>
    <tr>
      <th>skewness</th>
      <td>-0.3194</td>
      <td>-0.5904</td>
      <td>-0.3785</td>
      <td>-0.417</td>
    </tr>
    <tr>
      <th>excess_kurtosis</th>
      <td>-0.5048</td>
      <td>0.7985</td>
      <td>-0.6065</td>
      <td>-1.0258</td>
    </tr>
    <tr>
      <th>jb_statistic</th>
      <td>106.6976</td>
      <td>254.4822</td>
      <td>101.3559</td>
      <td>73.8708</td>
    </tr>
    <tr>
      <th>jb_pvalue</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="bootstrap-method">
<h3>Bootstrap method<a class="headerlink" href="#bootstrap-method" title="Permalink to this heading">#</a></h3>
<p>One simple but powerful improvement over basic HS is to estimate VaR and ES from bootstrapped data. The bootstrap procedure involves resampling from the existing data set with replacement.  Each new ‘resampled’ sample gives us a new VaR estimate, and their mean can be taken to be the best estimate, with standard error and confidence interval computed from the distribution of resample-based estimates. We can also use the bootstrap to estimate ES’s in much the same way.</p>
<p>Perhaps the main limitation of the bootstrap is that standard bootstrap procedures presuppose that observations are independent over time.  There are various way to modify bootstraps to allow for such dependence, such as the block approach: Divide sample data into non-overlapping blocks of equal length, and select a block at random.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bootstrap_risk</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculate bootstrap VaR, ES, confidence and plot VaR histogram&quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">bootstraps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">bootstraps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">historical_risk</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">))</span>
    <span class="n">bootstraps</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">bootstraps</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bootstraps</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">confidence_intervals</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Extracts confidence intervals and median from a series&quot;&quot;&quot;</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">confidence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">confidence</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="p">[</span><span class="n">lower</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">upper</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;inverted_cdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run and plot bootstrapped VaR and ES</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">confidence</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">intervals</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">,</span> <span class="s1">&#39;expected_shortfall&#39;</span><span class="p">]:</span>
    <span class="n">intervals</span><span class="p">[</span><span class="n">measure</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">bootstraps</span> <span class="o">=</span> <span class="n">bootstrap_risk</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="n">confidence_intervals</span><span class="p">(</span><span class="n">bootstraps</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span> <span class="n">confidence</span><span class="o">=</span><span class="n">confidence</span><span class="p">)</span>
        <span class="n">intervals</span><span class="p">[</span><span class="n">measure</span><span class="p">][</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">interval</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bootstraps</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">interval</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">interval</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;bootstrapped&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">confidence</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">% confidence bounds&quot;</span><span class="p">,</span>
                   <span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-small&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">interval</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Bootstrapped &#39;</span> <span class="o">+</span> <span class="n">measure</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0c24f844c1f17321a7a09bc5834b5ed4a0894336f214349309b0603ee47c384c.png" src="_images/0c24f844c1f17321a7a09bc5834b5ed4a0894336f214349309b0603ee47c384c.png" />
<img alt="_images/37c0d0a65b82e2aea7a7445e3996b216611b63c960f140c5fd5e1662e2d5447f.png" src="_images/37c0d0a65b82e2aea7a7445e3996b216611b63c960f140c5fd5e1662e2d5447f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display confidence intervals of VaR</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="n">intervals</span><span class="p">[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>\
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Value at Risk&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>Value at Risk</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lower</th>
      <td>0.080831</td>
      <td>0.056794</td>
      <td>0.072047</td>
      <td>0.078821</td>
    </tr>
    <tr>
      <th>median</th>
      <td>0.084858</td>
      <td>0.060644</td>
      <td>0.076511</td>
      <td>0.083562</td>
    </tr>
    <tr>
      <th>upper</th>
      <td>0.094109</td>
      <td>0.062483</td>
      <td>0.081622</td>
      <td>0.087124</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display confidence intervals of VaR</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="n">intervals</span><span class="p">[</span><span class="s1">&#39;expected_shortfall&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">])</span>\
    <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Expected Shortfall&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>Expected Shortfall</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lower</th>
      <td>0.006844</td>
      <td>0.002288</td>
      <td>0.004324</td>
      <td>0.005304</td>
    </tr>
    <tr>
      <th>median</th>
      <td>0.007976</td>
      <td>0.003185</td>
      <td>0.005357</td>
      <td>0.006525</td>
    </tr>
    <tr>
      <th>upper</th>
      <td>0.009545</td>
      <td>0.004016</td>
      <td>0.006594</td>
      <td>0.007911</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="conditional-volatility-models">
<h2>Conditional volatility models<a class="headerlink" href="#conditional-volatility-models" title="Permalink to this heading">#</a></h2>
<p>A return distribution may have parameters that vary through time. For ample, a simple mixture model of two normal distributions with different volatilities exhibits more peakedness and fatter tails than the normal. It is important to distinguish between a model where returns are unconditionally normal and a model where they are conditionally normal. In the latter, the return distribution is normal each day, while the standard deviation of the return varies throughout time (in other words, volatility is stochastic). During some periods it is high; during other periods it is low. This leads to an unconditional distribution with fat tails.</p>
<section id="ewma-model">
<h3>EWMA model<a class="headerlink" href="#ewma-model" title="Permalink to this heading">#</a></h3>
<p>Current volatility can be estimated as an equal-weighted average of recent squared returns. This makes a simplifying assumption that the expected return is 0, which is reasonable over short periods such as daily where the standard deviation of the return is much more important than the mean. One problem with using an equal average is that a large (squared) return entering or dropping out of the sample is that the volatility will experience a large one-day increase or drop.</p>
<p>One way of overcoming these problems is to use exponential smoothing,  which is also referred to as the exponentially weighted moving average (EWMA).  In EWMA, the weight applied to the squared return from <span class="math notranslate nohighlight">\(k\)</span> days ago is <span class="math notranslate nohighlight">\(\lambda\)</span> multiplied by the weight applied to the squared return <span class="math notranslate nohighlight">\(k-1\)</span> days ago (where <span class="math notranslate nohighlight">\(\lambda\)</span> is a positive constant that is less than one). In the 1990s, the JP Morgan RiskMetrics group used this approach and found that setting <span class="math notranslate nohighlight">\(\lambda=0.94\)</span> proved a good choice for estimating volatilies of a wide range of market variables.  The EWMA estimate can be conveniently expressed as a recursive equation:</p>
<div class="math notranslate nohighlight">
\[\sigma^2_t = (1 - \lambda) r^2_{t-1} + \lambda \sigma^2_{t-1}\]</div>
<p>This formula provides a very simple way of implementing EWMA. The new estimate of the variance rate on day n is a weighted average of he estimate of the variance rate made for the previous day <span class="math notranslate nohighlight">\((n - 1)\)</span>, and
the most recent observation of the squared return on day <span class="math notranslate nohighlight">\((n - 1)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate EWMA (lambda=0.94) rolling model predictions for all cryptos</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mf">0.94</span>
<span class="n">ewma</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">lambda_</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper to plot predicted VaR vs actual returns</span>
<span class="k">def</span> <span class="nf">plot_var</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">VaR</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper to plot returns and VaR predictions&quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span><span class="n">VaR</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">VaR</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;VaR&#39;</span><span class="p">,</span> <span class="s1">&#39;$-$VaR&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot daily returns and EWMA predicted VaR of all cryptos</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span>
                   <span class="n">parametric_risk</span><span class="p">(</span><span class="n">ewma</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">]</span>\
                   <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;VaR&#39;</span><span class="p">)],</span>
                  <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">plot_var</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">VaR</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="s1">&#39;VaR&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Returns and EWMA VaR (alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d5f753201ed002a4c800c48c38e0876cfa204c359180f70838bd3b9bedfaaebd.png" src="_images/d5f753201ed002a4c800c48c38e0876cfa204c359180f70838bd3b9bedfaaebd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Properties of EWMA normalized returns for all cryptos</span>
<span class="n">ewma_hist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">:</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">/</span> <span class="n">ewma</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># normalize by predict vol</span>
    <span class="n">ewma_hist</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">historical_risk</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized by EWMA predicted volatility (alpha=0.95)&quot;</span><span class="p">)</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="n">ewma_hist</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized by EWMA predicted volatility (alpha=0.95)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>N</th>
      <td>2301.0000</td>
      <td>3387.0000</td>
      <td>2885.0000</td>
      <td>2795.0000</td>
    </tr>
    <tr>
      <th>value_at_risk</th>
      <td>1.5056</td>
      <td>1.4689</td>
      <td>1.5831</td>
      <td>1.5682</td>
    </tr>
    <tr>
      <th>expected_shortfall</th>
      <td>0.1249</td>
      <td>0.0673</td>
      <td>0.0778</td>
      <td>0.0922</td>
    </tr>
    <tr>
      <th>volatility</th>
      <td>0.9260</td>
      <td>0.9220</td>
      <td>0.9417</td>
      <td>0.9416</td>
    </tr>
    <tr>
      <th>skewness</th>
      <td>0.1289</td>
      <td>-0.0729</td>
      <td>-0.0307</td>
      <td>0.0187</td>
    </tr>
    <tr>
      <th>excess_kurtosis</th>
      <td>-1.3967</td>
      <td>-1.4662</td>
      <td>-2.1265</td>
      <td>-1.7600</td>
    </tr>
    <tr>
      <th>jb_statistic</th>
      <td>252.8316</td>
      <td>334.9892</td>
      <td>92.1766</td>
      <td>179.2390</td>
    </tr>
    <tr>
      <th>jb_pvalue</th>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="garch-model">
<h3>GARCH model<a class="headerlink" href="#garch-model" title="Permalink to this heading">#</a></h3>
<p>The generalized autoregressive conditional heteroskedasticity or <strong>GARCH</strong> model, developed by Robert Engel and Tim Bollerslev, can be intuitively regarded as an extension of EWMA. In GARCH (1,1), we also give some weight to a long run average variance rate <span class="math notranslate nohighlight">\(\hat{\sigma}\)</span>. The updated formula for the variance rate is:</p>
<div class="math notranslate nohighlight">
\[\sigma^2_t = \alpha r^2_{t-1} + \beta \sigma^2_{t-1} + \gamma \hat{\sigma}\]</div>
<p>The weights must be sum to one, hence <span class="math notranslate nohighlight">\(\alpha + \beta \le 1\)</span> and <span class="math notranslate nohighlight">\(\gamma = 1 - \alpha - \beta\)</span>.</p>
<p>GARCH (1,1), compared to EWMA, incorporate mean-reversion where the <span class="math notranslate nohighlight">\(\hat{\sigma}\)</span> term provides a “pull” toward the long-run average mean. And just as with ARMA specifications of time series models, GARCH(p,q) can incorporate additional lags of <span class="math notranslate nohighlight">\(q\)</span> squared returns and <span class="math notranslate nohighlight">\(p\)</span> previous variance rate estimates to generate better fitting models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate GARCH(1, 1) by calling R&#39;s rugarch library</span>
<span class="kn">import</span> <span class="nn">rpy2.robjects</span> <span class="k">as</span> <span class="nn">ro</span>
<span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span>
<span class="kn">from</span> <span class="nn">finds.utils</span> <span class="kn">import</span> <span class="n">PyR</span>
<span class="k">def</span> <span class="nf">rugarch</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Series</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;GARCH(1,1) wrapper around rugarch&quot;&quot;&quot;</span>
    <span class="n">rugarch_ro</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;rugarch&#39;</span><span class="p">)</span>  <span class="c1"># to use library rugarch</span>
    <span class="n">c_</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
    <span class="n">list_</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ugarchspec&#39;</span><span class="p">](</span><span class="n">mean_model</span><span class="o">=</span><span class="n">list_</span><span class="p">(</span><span class="n">armaOrder</span><span class="o">=</span><span class="n">c_</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">include_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ugarchfit&#39;</span><span class="p">](</span><span class="n">spec</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">PyR</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">ro</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">](</span><span class="n">model</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">which</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">]:</span>
            <span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;plot&#39;</span><span class="p">](</span><span class="n">model</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="n">which</span><span class="p">)</span>
            <span class="n">PyR</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">savefig</span><span class="si">}{</span><span class="n">which</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Series</span><span class="p">(</span><span class="n">PyR</span><span class="p">(</span><span class="n">ro</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">](</span><span class="n">model</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                  <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Estimate GARCH(1,1) full period model for all cryptos</span>
<span class="n">garch</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">rugarch</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot daily returns and GARCH predicted VaR</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.95</span>   <span class="c1"># VaR parameter</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cryptos</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
                   <span class="n">parametric_risk</span><span class="p">(</span><span class="n">garch</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">]</span>\
                   <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;VaR&#39;</span><span class="p">)],</span>
                  <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">plot_var</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">VaR</span><span class="o">=</span><span class="n">Z</span><span class="p">[</span><span class="s1">&#39;VaR&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">titles</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Daily Returns and GARCH VaR (alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/2e951bc65992181d4ec898fb24f4a8a4e7c5edb67788edbfd871d32b34fea863.png" src="_images/2e951bc65992181d4ec898fb24f4a8a4e7c5edb67788edbfd871d32b34fea863.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Properties of GARCH normalized returns</span>
<span class="n">garch_hist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">:</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">/</span> <span class="n">garch</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># normalize by predict vol</span>
    <span class="n">garch_hist</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">historical_risk</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized by GARCH predicted volatility (alpha=0.95)&quot;</span><span class="p">)</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="n">garch_hist</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Normalized by GARCH predicted volatility (alpha=0.95)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>N</th>
      <td>2301.0000</td>
      <td>3387.0000</td>
      <td>2885.0000</td>
      <td>2795.0000</td>
    </tr>
    <tr>
      <th>value_at_risk</th>
      <td>1.3172</td>
      <td>1.2899</td>
      <td>1.4004</td>
      <td>1.4004</td>
    </tr>
    <tr>
      <th>expected_shortfall</th>
      <td>0.1053</td>
      <td>0.0467</td>
      <td>0.0755</td>
      <td>0.0844</td>
    </tr>
    <tr>
      <th>volatility</th>
      <td>0.7728</td>
      <td>0.7654</td>
      <td>0.8372</td>
      <td>0.8437</td>
    </tr>
    <tr>
      <th>skewness</th>
      <td>0.0286</td>
      <td>-0.0493</td>
      <td>-0.0064</td>
      <td>0.0512</td>
    </tr>
    <tr>
      <th>excess_kurtosis</th>
      <td>-2.6270</td>
      <td>-2.8977</td>
      <td>-2.8001</td>
      <td>-1.8373</td>
    </tr>
    <tr>
      <th>jb_statistic</th>
      <td>13.6517</td>
      <td>2.8470</td>
      <td>4.8221</td>
      <td>158.6495</td>
    </tr>
    <tr>
      <th>jb_pvalue</th>
      <td>0.0011</td>
      <td>0.2409</td>
      <td>0.0897</td>
      <td>0.0000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="backtesting-var">
<h2>Backtesting VaR<a class="headerlink" href="#backtesting-var" title="Permalink to this heading">#</a></h2>
<p>The simplest method to verify the accuracy of the model is to record the failure rate, which gives the proportion of times VaR is exceeded in a given sample. The number of violations or exceptions should follow a binomial distribution with probability of failure <span class="math notranslate nohighlight">\(p = 1 - \alpha\)</span>, where <em>alpha</em> is the VaR confidence level.  The VaR model can be rejected in two regions, both when the number of observed violations is too few or too many.</p>
<section id="kupiec-likelihood-ratio-test">
<h3>Kupiec Likelihood Ratio test<a class="headerlink" href="#kupiec-likelihood-ratio-test" title="Permalink to this heading">#</a></h3>
<p>Kupiec (1995) develops approximate 95 percent confidence regions for such a test, based on by the (two-sided) tail points of the log-likelihood ratio:</p>
<div class="math notranslate nohighlight">
\[LR = -2 [(N - S) \ln(1 - p) + S \ln(p)] + 2 [(N - S) \ln(1 - S/N) + S \ln(S/N)]  \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kupiec_LR</span><span class="p">(</span><span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute Kupiec likelihood ratio given s violations in n trials</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict of likelihood statistic and pvalue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span>       <span class="c1"># prob of violation</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="n">s</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">n</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">s</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="n">den</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="n">lr</span><span class="p">,</span> <span class="s1">&#39;violations&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span>
            <span class="c1"># &#39;5%_critical&#39;: stats.chi2.ppf(0.95, df=1),</span>
            <span class="s1">&#39;pvalue&#39;</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">stats</span><span class="o">.</span><span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mi">1</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kupiec</span><span class="p">(</span><span class="n">X</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">VaR</span><span class="p">:</span> <span class="n">Series</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Kupiec Likelihood Ratio test of VaR</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict of likelihood statistic and pvalue</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">VaR</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">Z</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># number of violations &lt; -VaR</span>
    <span class="k">return</span> <span class="n">kupiec_LR</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kupiec likelihood ratio test for EWMA</span>
<span class="n">row_formatted</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">kupiec</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
                   <span class="n">VaR</span><span class="o">=</span><span class="n">parametric_risk</span><span class="p">(</span><span class="n">ewma</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">})</span>\
              <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;EWMA(</span><span class="si">{</span><span class="n">lambda_</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Kupiec LR Test:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
              <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;violations&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Kupiec LR Test:</th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>EWMA(0.94)</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lr</th>
      <td>1.6293</td>
      <td>3.2575</td>
      <td>1.3298</td>
      <td>2.7826</td>
    </tr>
    <tr>
      <th>violations</th>
      <td>102</td>
      <td>147</td>
      <td>131</td>
      <td>121</td>
    </tr>
    <tr>
      <th>N</th>
      <td>2302</td>
      <td>3388</td>
      <td>2886</td>
      <td>2796</td>
    </tr>
    <tr>
      <th>pvalue</th>
      <td>0.2018</td>
      <td>0.0711</td>
      <td>0.2488</td>
      <td>0.0953</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kupiec likelihood ratio test for GARCH(1,1)</span>
<span class="n">row_formatted</span><span class="p">(</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">kupiec</span><span class="p">(</span><span class="n">cryptos</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
                   <span class="n">VaR</span><span class="o">=</span><span class="n">parametric_risk</span><span class="p">(</span><span class="n">garch</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)[</span><span class="s1">&#39;value_at_risk&#39;</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">cryptos</span><span class="p">})</span>\
              <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;GARCH(1,1)&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;Kupiec LR Test:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
              <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;violations&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.0f}</span><span class="s1">&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Kupiec LR Test:</th>
      <th>CBBCHUSD</th>
      <th>CBBTCUSD</th>
      <th>CBETHUSD</th>
      <th>CBLTCUSD</th>
    </tr>
    <tr>
      <th>GARCH(1,1)</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lr</th>
      <td>5.2248</td>
      <td>5.302</td>
      <td>3.8198</td>
      <td>10.5494</td>
    </tr>
    <tr>
      <th>violations</th>
      <td>92</td>
      <td>141</td>
      <td>122</td>
      <td>104</td>
    </tr>
    <tr>
      <th>N</th>
      <td>2302</td>
      <td>3388</td>
      <td>2886</td>
      <td>2796</td>
    </tr>
    <tr>
      <th>pvalue</th>
      <td>0.0223</td>
      <td>0.0213</td>
      <td>0.0507</td>
      <td>0.0012</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="conditional-coverage-tests">
<h3>Conditional coverage tests<a class="headerlink" href="#conditional-coverage-tests" title="Permalink to this heading">#</a></h3>
<p>This framework focuses on unconditional coverage because it ignores  time variation in the data. In theory, the exceptions should be evenly spread over time.  The observations could cluster or “bunch” closely in time, which also may invalidate the model. The LR statistic can be extended to specify that the deviations must be serially independent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># TODO: conditional likelihood test</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="bond_returns.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Bond Returns and Risks</p>
      </div>
    </a>
    <a class="right-next"
       href="covariance_matrix.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Covariance Matrix</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#value-at-risk">Value at Risk</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coherence">Coherence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametric-method">Parametric method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#delta-normal-method">Delta-Normal method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-simulation-method">Monte Carlo Simulation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-simulation-method">Historical Simulation method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stressed-var-method">Stressed VaR method</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bootstrap-method">Bootstrap method</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-volatility-models">Conditional volatility models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ewma-model">EWMA model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#garch-model">GARCH model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#backtesting-var">Backtesting VaR</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kupiec-likelihood-ratio-test">Kupiec Likelihood Ratio test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-coverage-tests">Conditional coverage tests</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Terence Lim
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>