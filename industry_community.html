

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Community Detection &#8212; Financial Data Science Python Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'industry_community';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Link Prediction" href="link_prediction.html" />
    <link rel="prev" title="Graph Centrality" href="bea_centrality.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="README.html">
  
  
  
  
  
    <p class="title logo__title">Financial Data Science Python Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="README.html">
                    Financial Data Science Notebooks
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="stock_prices.html">Stock prices</a></li>
<li class="toctree-l1"><a class="reference internal" href="jegadeesh_titman.html">Jegadeesh-Titman Rolling Portfolios</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_french.html">Fama-French Portfolio Sorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="fama_macbeth.html">Fama-Macbeth Cross-sectional Regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="weekly_reversal.html">Weekly reversal</a></li>
<li class="toctree-l1"><a class="reference internal" href="quant_factors.html">Quant Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="event_study.html">Event Study</a></li>

<li class="toctree-l1"><a class="reference internal" href="economic_releases.html">Economic Data Revisions</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_diagnostics.html">Linear Regression Diagonostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="econometric_forecast.html">Econometric Forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="approximate_factors.html">Approximate Factor Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="economic_states.html">State Space Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_volatility.html">Conditional Volatility</a></li>

<li class="toctree-l1"><a class="reference internal" href="covariance_matrix.html">Covariance Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="term_structure.html">Term Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="bond_returns.html">Bond Returns</a></li>
<li class="toctree-l1"><a class="reference internal" href="options_pricing.html">Options Pricing</a></li>
<li class="toctree-l1"><a class="reference internal" href="market_microstructure.html">Market Microstructure</a></li>

<li class="toctree-l1"><a class="reference internal" href="event_risk.html">Event risk</a></li>
<li class="toctree-l1"><a class="reference internal" href="customer_ego.html">Principal Customers Network</a></li>

<li class="toctree-l1"><a class="reference internal" href="bea_centrality.html">Graph Centrality</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Community Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="link_prediction.html">Link Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="spatial_regression.html">Spatial Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_topics.html">Topic Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="management_sentiment.html">Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="business_description.html">10-K Business Description</a></li>


<li class="toctree-l1"><a class="reference internal" href="classification_models.html">Classification for supervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression_models.html">Regression for supervised learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="deep_classifier.html">Deep Averaging Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="convolutional_net.html">Temporal Convolution Net</a></li>
<li class="toctree-l1"><a class="reference internal" href="recurrent_net.html">Recurrent Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="fomc_language.html">Language Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="reinforcement_learning.html">Reinforcement Learning</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/terence-lim/data-science-notebooks.git/issues/new?title=Issue%20on%20page%20%2Findustry_community.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/industry_community.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Community Detection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="community-detection">
<h1>Community Detection<a class="headerlink" href="#community-detection" title="Permalink to this heading">#</a></h1>
<p><em>UNDER CONSTRUCTION</em></p>
<ul class="simple">
<li><p>Community Detection and Industry Sectoring</p></li>
<li><p>TNIC (Text-based Network Industry Classification), see Hoberg and Phillips (2016)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">networkx.algorithms.community</span> <span class="k">as</span> <span class="nn">nx_comm</span>
<span class="kn">from</span> <span class="nn">finds.database</span> <span class="kn">import</span> <span class="n">SQL</span>
<span class="kn">from</span> <span class="nn">finds.readers</span> <span class="kn">import</span> <span class="n">requests_get</span><span class="p">,</span> <span class="n">Sectoring</span>
<span class="kn">from</span> <span class="nn">finds.busday</span> <span class="kn">import</span> <span class="n">BusDay</span>
<span class="kn">from</span> <span class="nn">finds.structured</span> <span class="kn">import</span> <span class="n">PSTAT</span>
<span class="kn">from</span> <span class="nn">finds.misc</span> <span class="kn">import</span> <span class="n">Show</span>
<span class="kn">from</span> <span class="nn">finds.graph</span> <span class="kn">import</span> <span class="n">graph_info</span><span class="p">,</span> <span class="n">community_quality</span><span class="p">,</span> <span class="n">community_detection</span>
<span class="kn">from</span> <span class="nn">secret</span> <span class="kn">import</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">paths</span>
<span class="c1"># %matplotlib qt</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">show</span> <span class="o">=</span> <span class="n">Show</span><span class="p">(</span><span class="n">ndigits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">latex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="o">**</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;sql&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">bd</span> <span class="o">=</span> <span class="n">BusDay</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="n">pstat</span> <span class="o">=</span> <span class="n">PSTAT</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">imgdir</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="s1">&#39;images&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="s1">&#39;tnic&#39;</span>  <span class="c1"># None</span>
<span class="n">tnic_scheme</span> <span class="o">=</span> <span class="s1">&#39;tnic3&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last FamaFrench Date 2023-06-30 00:00:00
</pre></div>
</div>
</div>
</div>
<p>Retrieve TNIC scheme from Hoberg and Phillips website</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## https://hobergphillips.tuck.dartmouth.edu/industryclass.htm</span>
<span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;https://hobergphillips.tuck.dartmouth.edu/idata/&#39;</span>   
<span class="n">source</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="n">tnic_scheme</span> <span class="o">+</span> <span class="s1">&#39;_data.zip&#39;</span>
<span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests_get</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tnic_scheme</span> <span class="o">+</span> <span class="s2">&quot;_data.txt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">tnic_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
<span class="n">tnic_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>gvkey1</th>
      <th>gvkey2</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1988</td>
      <td>1011</td>
      <td>3226</td>
      <td>0.1508</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1988</td>
      <td>1011</td>
      <td>6282</td>
      <td>0.0851</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1988</td>
      <td>1011</td>
      <td>6734</td>
      <td>0.0258</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1988</td>
      <td>1011</td>
      <td>7609</td>
      <td>0.0097</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1988</td>
      <td>1011</td>
      <td>9526</td>
      <td>0.0369</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25657913</th>
      <td>2021</td>
      <td>345556</td>
      <td>345556</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25657914</th>
      <td>2021</td>
      <td>345920</td>
      <td>345920</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25657915</th>
      <td>2021</td>
      <td>345980</td>
      <td>345980</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25657916</th>
      <td>2021</td>
      <td>347007</td>
      <td>347007</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25657917</th>
      <td>2021</td>
      <td>349972</td>
      <td>349972</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>25657918 rows × 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loop over representative years for community detection</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1989</span><span class="p">,</span> <span class="mi">1999</span><span class="p">,</span> <span class="mi">2009</span><span class="p">,</span> <span class="mi">2019</span><span class="p">]</span>  <span class="c1"># [1999, 2019]:</span>
<span class="n">collect</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;modularity&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;community&#39;</span><span class="p">:</span> <span class="p">{}}</span>  <span class="c1"># to collect metrics</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    
    <span class="c1"># extract one year of tnic as data frame</span>
    <span class="n">tnic</span> <span class="o">=</span> <span class="n">tnic_data</span><span class="p">[</span><span class="n">tnic_data</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tnic</span><span class="p">[</span><span class="s1">&#39;gvkey1&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">tnic</span><span class="p">[</span><span class="s1">&#39;gvkey2&#39;</span><span class="p">])))</span>

    <span class="c1"># with gvkey, lookup permno, sic and naics codes</span>
    <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lpermno&#39;</span><span class="p">,</span> <span class="s1">&#39;sic&#39;</span><span class="p">,</span> <span class="s1">&#39;naics&#39;</span><span class="p">]:</span>
        <span class="n">lookup</span> <span class="o">=</span> <span class="n">pstat</span><span class="o">.</span><span class="n">build_lookup</span><span class="p">(</span><span class="s1">&#39;gvkey&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">fillna</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nodes</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">lookup</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">naics</span> <span class="o">=</span> <span class="n">Sectoring</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s1">&#39;naics&#39;</span><span class="p">,</span> <span class="n">fillna</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># supplement from crosswalk</span>
    <span class="n">sic</span> <span class="o">=</span> <span class="n">Sectoring</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s1">&#39;sic&#39;</span><span class="p">,</span> <span class="n">fillna</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;naics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;naics&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;naics&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                            <span class="n">naics</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;sic&#39;</span><span class="p">]])</span>
    <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;sic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;sic&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;sic&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                                        <span class="n">naics</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;naics&#39;</span><span class="p">]])</span>
    <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Non-missing&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

    <span class="c1"># apply sectoring schemes, and store in nodes DataFrame</span>
    <span class="n">schemes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sic&#39;</span><span class="p">:</span> <span class="p">([</span><span class="sa">f</span><span class="s2">&quot;codes</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">49</span><span class="p">]]</span>
                       <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;sic2&#39;</span><span class="p">,</span> <span class="s1">&#39;sic3&#39;</span><span class="p">]),</span>
               <span class="s1">&#39;naics&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;bea1947&#39;</span><span class="p">,</span> <span class="s1">&#39;bea1963&#39;</span><span class="p">,</span> <span class="s1">&#39;bea1997&#39;</span><span class="p">]}</span>
    <span class="n">codes</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># intermediate to combine raw sic/naics to sector scheme</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">schemes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">sub</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
                <span class="n">fillna</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">scheme</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;sic&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">codes</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sectoring</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">fillna</span><span class="o">=</span><span class="n">fillna</span><span class="p">)</span>
                <span class="n">nodes</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span> <span class="o">=</span> <span class="n">codes</span><span class="p">[</span><span class="n">scheme</span><span class="p">][</span><span class="n">nodes</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="n">codes</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">)]</span>
    <span class="n">nodes</span>

    <span class="c1"># create edges</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">tnic</span><span class="p">[</span><span class="n">tnic</span><span class="p">[</span><span class="s1">&#39;gvkey1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span>
                 <span class="n">tnic</span><span class="p">[</span><span class="s1">&#39;gvkey2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">edges</span><span class="p">[[</span><span class="s1">&#39;gvkey1&#39;</span><span class="p">,</span> <span class="s1">&#39;gvkey2&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">]]</span>\
                 <span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>

    <span class="c1"># populate graph</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

    <span class="c1"># remove self-loops: not necessary</span>
    <span class="n">g</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">selfloop_edges</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>

    <span class="c1"># graph info</span>
    <span class="n">collect</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">graph_info</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="c1"># Plot degree distribution</span>
<span class="c1">#    num = num + 1</span>
<span class="c1">#    fig, ax = plt.subplots(clear=True, num=num, figsize=(10,6))</span>
<span class="c1">#    Series(nx.degree_histogram(g)).hist(grid=False, ax=ax, bins=100)</span>
<span class="c1">#    ax.set_title(f&#39;Degree Distribution of {tnic_scheme.upper()} links {year}&#39;)</span>
<span class="c1">#    plt.tight_layout(pad=3)</span>
<span class="c1">#    plt.savefig(os.path.join(imgdir, f&#39;degree{year}&#39; + figext))</span>
    
    <span class="c1"># evaluate modularity of sectoring schemes</span>
    <span class="n">modularity</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">schemes</span><span class="o">.</span><span class="n">values</span><span class="p">())):</span>
        <span class="n">communities</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span> <span class="n">scheme</span><span class="p">]</span>\
                           <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>\
                           <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">scheme</span><span class="p">)[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span>\
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>\
                           <span class="o">.</span><span class="n">to_list</span><span class="p">()</span>    <span class="c1"># list of list of symbols</span>
        <span class="n">modularity</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_quality</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">communities</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">modularity</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">collect</span><span class="p">[</span><span class="s1">&#39;modularity&#39;</span><span class="p">][</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
    <span class="n">show</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Modularity of sectoring schemes </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># detect communities and report modularity</span>
    <span class="n">communities</span> <span class="o">=</span> <span class="n">community_detection</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">quality</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">community</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">quality</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_quality</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">community</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;total elapsed:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tic</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">key</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">quality</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
    <span class="n">collect</span><span class="p">[</span><span class="s1">&#39;community&#39;</span><span class="p">][</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
    <span class="n">show</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Modularity community detection algorithms </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Plot Fama-French codes49 industry representation as heatmap</span>
    <span class="k">for</span> <span class="n">ifig</span><span class="p">,</span> <span class="n">detection</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="s1">&#39;louvain&#39;</span><span class="p">]):</span>
        <span class="n">scheme</span> <span class="o">=</span> <span class="s1">&#39;codes49&#39;</span>
        <span class="n">industry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">community</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">communities</span><span class="p">[</span><span class="n">detection</span><span class="p">],</span>
                                             <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span>
                                             <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
            <span class="n">industry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">scheme</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">community</span><span class="p">)]</span>\
                            <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>\
                            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">industry</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>\
               <span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">codes</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span>\
                        <span class="o">.</span><span class="n">sectors</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>\
                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">keep</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">))</span>

        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="mi">10</span><span class="p">],</span>
                    <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">yticklabels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span>
                    <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scheme</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;bea&#39;</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">Sectoring</span><span class="o">.</span><span class="n">_bea_industry</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">detection</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> Community Detection </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Industry representation in communities&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{scheme}</span><span class="s1"> industry&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">imgdir</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">detection</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Modularity of sectoring schemes 1989
------------------------------------
         communities  modularity  coverage  performance
bea1947           42      0.1534    0.6464       0.9307
bea1963           59      0.1901    0.4979       0.9515
bea1997           63      0.1884    0.4940       0.9525
codes10           10      0.1568    0.7480       0.8491
codes12           12      0.1614    0.7190       0.8821
codes17           17      0.1556    0.7027       0.8428
codes30           30      0.1538    0.6939       0.9156
codes38           37      0.1484    0.6794       0.9130
codes48           48      0.1987    0.5186       0.9560
codes49           49      0.1986    0.5177       0.9584
codes5             5      0.1595    0.7739       0.7900
sic2              69      0.1951    0.4958       0.9562
sic3             258      0.1985    0.2984       0.9696

3.0 secs: label_propogation
5.0 secs: louvain
38.0 secs: greedy
total elapsed: 0.0 label
total elapsed: 1.0 louvain
total elapsed: 1.0 greedy
Modularity community detection algorithms 1989
----------------------------------------------
         communities  modularity  coverage  performance
greedy            33      0.2951    0.9437       0.6972
label            152      0.2358    0.9845       0.7812
louvain           31      0.3452    0.6924       0.8630

Modularity of sectoring schemes 1999
------------------------------------
         communities  modularity  coverage  performance
bea1947           42      0.2775    0.7493       0.9330
bea1963           60      0.2938    0.6254       0.9582
bea1997           64      0.2924    0.6228       0.9591
codes10           10      0.2903    0.8650       0.8477
codes12           12      0.2988    0.8543       0.8780
codes17           17      0.2792    0.8435       0.8133
codes30           30      0.2856    0.8063       0.9124
codes38           37      0.2780    0.7919       0.9018
codes48           48      0.3120    0.6701       0.9523
codes49           49      0.3130    0.6727       0.9587
codes5             5      0.2919    0.8867       0.7964
sic2              71      0.3128    0.6503       0.9539
sic3             263      0.2671    0.4278       0.9660

2.0 secs: label_propogation
9.0 secs: louvain
101.0 secs: greedy
total elapsed: 1.0 label
total elapsed: 1.0 louvain
total elapsed: 2.0 greedy
Modularity community detection algorithms 1999
----------------------------------------------
         communities  modularity  coverage  performance
greedy            41      0.3170    0.9802       0.7217
label            146      0.3421    0.9733       0.8481
louvain           27      0.3601    0.9631       0.8268

Modularity of sectoring schemes 2009
------------------------------------
         communities  modularity  coverage  performance
bea1947           41      0.3185    0.8310       0.9339
bea1963           58      0.3441    0.7318       0.9593
bea1997           62      0.3427    0.7291       0.9599
codes10           10      0.3256    0.9137       0.8484
codes12           12      0.3285    0.9068       0.8795
codes17           17      0.2829    0.8442       0.8322
codes30           30      0.3243    0.8915       0.9062
codes38           36      0.3136    0.8524       0.9012
codes48           48      0.3533    0.7505       0.9586
codes49           49      0.3531    0.7497       0.9622
codes5             5      0.3279    0.9335       0.8006
sic2              69      0.3500    0.7271       0.9585
sic3             241      0.2960    0.5228       0.9689

1.0 secs: label_propogation
3.0 secs: louvain
27.0 secs: greedy
total elapsed: 0.0 label
total elapsed: 1.0 louvain
total elapsed: 1.0 greedy
Modularity community detection algorithms 2009
----------------------------------------------
         communities  modularity  coverage  performance
greedy            36      0.2981    0.9810       0.6656
label            124      0.3651    0.9662       0.9226
louvain           27      0.3973    0.9305       0.8521

Modularity of sectoring schemes 2019
------------------------------------
         communities  modularity  coverage  performance
bea1947           41      0.4666    0.7492       0.9275
bea1963           59      0.4643    0.6834       0.9525
bea1997           63      0.4639    0.6825       0.9530
codes10           10      0.4713    0.9250       0.8419
codes12           12      0.4859    0.9082       0.8795
codes17           17      0.3787    0.7500       0.8006
codes30           30      0.4828    0.9002       0.9003
codes38           36      0.4692    0.7684       0.8923
codes48           48      0.4749    0.7086       0.9486
codes49           49      0.4749    0.7081       0.9528
codes5             5      0.4743    0.9370       0.8067
sic2              69      0.4688    0.6941       0.9481
sic3             233      0.4152    0.6211       0.9615

2.0 secs: label_propogation
4.0 secs: louvain
28.0 secs: greedy
total elapsed: 0.0 label
total elapsed: 1.0 louvain
total elapsed: 1.0 greedy
Modularity community detection algorithms 2019
----------------------------------------------
         communities  modularity  coverage  performance
greedy            26      0.4936    0.9775       0.7110
label             91      0.4951    0.9830       0.8971
louvain           21      0.4978    0.9848       0.8398
</pre></div>
</div>
<img alt="_images/956a0b91d511806a2bc4a5c3ebe43fac9ab3f2c5097097d73419048ba00cd2e7.png" src="_images/956a0b91d511806a2bc4a5c3ebe43fac9ab3f2c5097097d73419048ba00cd2e7.png" />
<img alt="_images/4160836817b05b171b6a52189fcf6fc76088c6740f065d9129450a0db608fe82.png" src="_images/4160836817b05b171b6a52189fcf6fc76088c6740f065d9129450a0db608fe82.png" />
<img alt="_images/21c0684f89760bd8fb9b7bac580872f8e0c64d1e51365c6899afc72453115ed2.png" src="_images/21c0684f89760bd8fb9b7bac580872f8e0c64d1e51365c6899afc72453115ed2.png" />
<img alt="_images/b92d67de0a907782542e74f28b22aee2e77c8e22a7a51b3c4af186258db76100.png" src="_images/b92d67de0a907782542e74f28b22aee2e77c8e22a7a51b3c4af186258db76100.png" />
<img alt="_images/e1a935fbde00c71f5405ea8c26a67ee7861a5beabdbac25ce751f2dbe62aee2b.png" src="_images/e1a935fbde00c71f5405ea8c26a67ee7861a5beabdbac25ce751f2dbe62aee2b.png" />
<img alt="_images/f72164b372c8f8ac274596198731912b6449b451e4c025333394ebf134e5ba9b.png" src="_images/f72164b372c8f8ac274596198731912b6449b451e4c025333394ebf134e5ba9b.png" />
<img alt="_images/2d121959f76609caabb837c42e5d06d179b45d3f4218c76f7c0d86b5977243c8.png" src="_images/2d121959f76609caabb837c42e5d06d179b45d3f4218c76f7c0d86b5977243c8.png" />
<img alt="_images/e6280ad8c640b37bb3aa8eaa90fa85d26c367fe517594eb2a78272460d24eb98.png" src="_images/e6280ad8c640b37bb3aa8eaa90fa85d26c367fe517594eb2a78272460d24eb98.png" />
<img alt="_images/656597d44f194dc32f7672be9615bb5c0ae7b4eb2b540d1471f37c567392eed8.png" src="_images/656597d44f194dc32f7672be9615bb5c0ae7b4eb2b540d1471f37c567392eed8.png" />
<img alt="_images/e7f759fda2c2430bedb5bc9ec14c78f06d0574e2b3bedc1e3b434783751f88f5.png" src="_images/e7f759fda2c2430bedb5bc9ec14c78f06d0574e2b3bedc1e3b434783751f88f5.png" />
<img alt="_images/14cb9adfb0d44301963110de17956c5455849149467f3d197578a5225c1c97fc.png" src="_images/14cb9adfb0d44301963110de17956c5455849149467f3d197578a5225c1c97fc.png" />
<img alt="_images/3e648d8e408e7641108e26ed9693672a51379f16ffe0df638ecaf1cb52e2d049.png" src="_images/3e648d8e408e7641108e26ed9693672a51379f16ffe0df638ecaf1cb52e2d049.png" />
</div>
</div>
<p>Display latest year info</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">collect</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="mi">2019</span><span class="p">],</span>
     <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tnic_scheme</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> graph info:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tnic3 2019 graph info:
----------------------
                            2019
connected                  False
connected_components          14
size_largest_component      3635
directed                   False
weighted                    True
negatively_weighted        False
edges                     318913
nodes                       3669
selfloops                      0
density                 0.047394
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">collect</span><span class="p">[</span><span class="s1">&#39;community&#39;</span><span class="p">][</span><span class="mi">2019</span><span class="p">],</span>
     <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tnic_scheme</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> community detection:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tnic3 2019 community detection:
-------------------------------
         communities  modularity  coverage  performance
greedy            26      0.4936    0.9775       0.7110
label             91      0.4951    0.9830       0.8971
louvain           21      0.4978    0.9848       0.8398
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">collect</span><span class="p">[</span><span class="s1">&#39;modularity&#39;</span><span class="p">][</span><span class="mi">2019</span><span class="p">],</span>
     <span class="n">caption</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> modularity of industry sectoring crosswalk schemes:&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2019 modularity of industry sectoring crosswalk schemes:
--------------------------------------------------------
         communities  modularity  coverage  performance
bea1947           41      0.4666    0.7492       0.9275
bea1963           59      0.4643    0.6834       0.9525
bea1997           63      0.4639    0.6825       0.9530
codes10           10      0.4713    0.9250       0.8419
codes12           12      0.4859    0.9082       0.8795
codes17           17      0.3787    0.7500       0.8006
codes30           30      0.4828    0.9002       0.9003
codes38           36      0.4692    0.7684       0.8923
codes48           48      0.4749    0.7086       0.9486
codes49           49      0.4749    0.7081       0.9528
codes5             5      0.4743    0.9370       0.8067
sic2              69      0.4688    0.6941       0.9481
sic3             233      0.4152    0.6211       0.9615
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="bea_centrality.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Graph Centrality</p>
      </div>
    </a>
    <a class="right-next"
       href="link_prediction.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Link Prediction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Terence Lim
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>